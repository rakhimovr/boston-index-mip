---
title: "Make It Personal: Boston Index Results"
output: 
      html_document:
            toc: TRUE
date: '`r format(Sys.time(), "%d %B, %Y")`'
author:
- Erik Thulin, ethulin@rare.org
- Rakhim Rakhimov, rrakhimov@rare.org
---

```{r setup, include = FALSE, echo = FALSE, results = 'asis'}
library(tidyverse)
library(haven)
library(labelled)
library(data.table)
library(knitr)
library(reactable)
library(htmltools)
library(lubridate)
library(hrbrthemes)
library(survey)
options(scipen = 999)
library(scales)
library(fastDummies)
require(lattice)
library(corrr)
library(dotwhisker)
library(socviz)

data <- read_sav("spss_4_29_2021.sav")
lucid_data <-read.csv("lucid_response_4_29_2021.csv")
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE}
lucid_data <- lucid_data %>% 
  filter(SupplierName != "Z - Test Supplier") %>% # remove test responses
  select(-HISPANIC.3., -REGION.6., -Ethnicity...Detailed.7.) %>% 
  mutate(
    ID = as.character(Response.ID),
    ID = tolower(ID))

data$ID <- data$var13

data <- merge(x = lucid_data, y = data, by = "ID", all.y = TRUE)
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE}
data <- data %>%
select(-PID, -MID, -RespondentSID, -Response.ID, -IsLive, -Survey.Number, -SurveyName, -STATE.4., -ZIP.2., -Vcid, -Vcomment, -Vlanguage, -Vreferer, -Vsessionid, -Vuseragent, -VGeoCountry, -Vpostal, var10, -var112, -var113, -var10) %>% 
rename(sex = var3,
       age = var2,
       White = var8O33,
       Black = var8O34,
       Native_American = var8O35,
       Asian = var8O36,
       Native_Hawaiian = var8O37,
       Other = var8O38,
       ethnicity = ETHNICITY.8.) %>% 
mutate(sex = case_when(sex == 10003 ~ "Male", TRUE ~ "Female"),
       ethnicity = case_when(Vrid == 394 ~ "White", 
                             Vrid == 1008 ~ "Asian", 
                             Vrid == 184 ~ "White", 
                             Vrid == 1505 ~ "Black", 
                             Vrid == 193 ~ "Black",
                             Vrid == 1815 ~ "Black",
                             TRUE ~ ethnicity),
       ethnicity = case_when(ethnicity == 1 ~ "White", 
                             ethnicity == 2 ~ "Black", 
                             ethnicity == 3 ~ "Alaska_Native", 
                             ethnicity == 4 ~ "Asian", 
                             ethnicity == 5 ~ "Asian", 
                             ethnicity == 6 ~ "Asian", 
                             ethnicity == 7 ~ "Asian", 
                             ethnicity == 8 ~ "Asian", 
                             ethnicity == 9 ~ "Asian", 
                             ethnicity == 10 ~ "Asian", 
                             ethnicity == 15 ~ "Other", 
                             TRUE ~ ethnicity)) %>%
  filter(age >= 18 & age <= 150)
```

```{r, include=FALSE, echo = FALSE, warning = FALSE}
#Demo prop
demo <- read.csv("demo_w.csv")

demo <- demo %>% 
  select(-`ï..demo_combined`) %>% 
  filter(prop > 0) %>% 
  rename(sex = gender,
         pop.demo.prop = prop,
         ethnicity = race)

# Create age brackets
agebreaks <- c(18, 25, 35, 45, 55, 65, 100)
agelabels <- c("18-24", "25-34", "35-44", "45-54", "55-64", "65+")
# Add age brackets to df
setDT(data)[ , age_group := cut(age, 
                                breaks = agebreaks, 
                                right = FALSE, 
                                labels = agelabels)]

data$ethnicity <- as.factor(data$ethnicity)

#Demo sample
#Counting demos in sample
d <- data %>% 
  select(Vrid, sex, age_group, ethnicity)

d <- d %>% 
  group_by(sex, ethnicity, age_group) %>%
  summarise(count=n()) 

d <- d %>% 
  mutate(sample.demo.prop = count/sum(d$count))

#Merging population and sample demos. Demo groups in pop need to be the same as demo groups in sample.

d <- merge(x = d, y = demo, by = c("ethnicity", "age_group", "sex"), all.x = TRUE)

#d <- d %>% 
#  mutate(demo_weight = pop.demo.prop/sample.demo.prop) 

#d <- d %>% select(ethnicity, age_group, sex, demo_weight)
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE}
# ZIP weight population
pop_zip <- read.csv("geocorr_cbsa_zip.csv")

pop_zip <- pop_zip %>% 
  filter(cbsa == "14460") %>% 
  select(-cbsa, -cbsaname15, -zipname)

pop_zip$zip <- as.numeric(as.character(pop_zip$zcta))
pop_zip$zip.pop <- as.numeric(as.character(pop_zip$pop10))
pop_zip$pop.zip.prop <- as.numeric(as.character(pop_zip$afact))

pop_zip <- pop_zip %>% 
  filter(zip < 99999) %>% 
  select(zip, zip.pop, pop.zip.prop)
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE}
#ZIP weight sample
df <- data %>% 
  select(Vrid, var21)
  
df$zip <- as.numeric(as.character(df$var21))
df$ID <- as.numeric(as.character(df$Vrid))

df <- df %>% 
  select(ID, zip)%>% 
  gather(ID, zip) %>% 
  group_by(zip) %>%
  summarise(count=n()) 

df <- df %>% 
  mutate(sample.zip.prop = count/sum(count))

df <- merge(df, pop_zip, by = "zip")

df <- df %>% 
  mutate(zip.weight = pop.zip.prop/sample.zip.prop)

df <- df %>% 
  select(zip, zip.weight)
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE}
data$zip <- as.numeric(as.character(data$var21))

df$Vrid <- df$ID

#merge demos (don't need to do that)
#data <- merge(x = d, y = data, by = c("ethnicity", "age_group", "sex"), all.y = #TRUE)

data <- data %>% 
  unite(demo, ethnicity, sex, age_group, remove = FALSE)

#dont need to do that
#data <- merge(x = df, y = data, by = "zip", all.y = TRUE)
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE}
demo <- demo %>%
  unite(demo, ethnicity, sex, age_group, remove = FALSE)

d <- d %>%
  unite(demo, ethnicity, sex, age_group, remove = FALSE)

demo <- merge(x = d, y = demo, by = c("demo"), all.x = TRUE)

demo.dist <- data.frame(demo = demo$demo,
                       Freq = nrow(data) * demo$pop.demo.prop.x)

#demo.dist$demo <- as.character(demo.dist$demo)

#puma.dist <- data.frame(puma = puma$puma,
#                        Freq = nrow(data) * puma$puma_prop)

zip1 <- merge(x = df, y = pop_zip, by = "zip", all.x = TRUE)

zip.dist <- data.frame(zip = zip1$zip,
                             Freq = nrow(data) * zip1$pop.zip.prop)

# Create the un-weighted survey object
svy.unweighted <- svydesign(ids = ~ 1, data = data)

#data <- data %>% rename(zip = zip.x)

# Create survey design object with weights
svy.rake <- rake(design = svy.unweighted,
                   sample.margins = list(~demo, ~zip),
                   population.margins = list(demo.dist, zip.dist))

svy.rake.demo <- rake(design = svy.unweighted,
                   sample.margins = list(~demo),
                   population.margins = list(demo.dist))

summary(weights(svy.rake))
summary(weights(svy.rake.demo))

#svy.rake.trim <- trimWeights(svy.rake, lower = 0.3, upper = 3, strict = TRUE)

# Extract weight values
wt <- data.frame(wt = weights(svy.rake))

# Bind weights with the df, re-order variable
data <- cbind(data, wt)

data <- data %>% 
  select(wt, ID:age_group)
```

### Research Overview

- Sampled 1,155 adult residents of the Boston core-based statistical area (CBSA), quota matched on age, gender, and ethnicity and weighted by ZIP
- For each MIP behavior:
  + Measured current self-reported *adoption*, *intention to adopt in the future*, and three social expectation measures - *belief that others are adopting the behavior*, *belief that others should adopt the behavior*, and *belief that others think people should adopt the behavior*
  + Measured stated *interest in participating in a program* that helps adopt the behavior
- For six out of seven MIP behaviors, measured perceived relative *carbon mitigation impact* of that behavior compared to a list of low-impact behaviors

### Results Overview

#### General trends  
* Higher reported adoption of MIP behaviors among Boston residents compared to the general population
  + Reported flying frequency and food waste reduction measures are not reported due to the difference in survey items between the two samples
```{r, echo = FALSE, results = 'asis', message = FALSE}
Behavior <- c("% of households that own at least 1 EV", "% of people that bought a carbon offset in the last year", "% of households that get electricity from a green energy provider", "% of households that have solar panels", "% of people's meals that do not include meat")
`Boston sample` <- c("15%", "6%", "15%", "11%", "5%")
`General population` <- c("11%", "2%", "9%", "4%", "6%")

df <- data.frame(Behavior, `Boston sample`, `General population`)

df = reactable(df,
  style = list(fontSize = "12px"),
  defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = FALSE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = FALSE,
    # apply defaults
    # 100 px and align to center of column
    defaultColDef = colDef(
      align = "center",
      minWidth = 100),
  # Add theme for the top border
    theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )
    ),
  columns = list(
    Behavior = colDef(
      minWidth = 360,
      align = "left"),
    `General.population` = colDef(
      name = "General population",
      minWidth = 140,
      align = "left"),
    `Boston.sample` = colDef(
      name = "Boston sample",
      minWidth = 100,
      align = "left")))

df
```
- Lack of awareness about the relative climate impact of low-impact and high-impact behaviors
  + People underestimate the impact of several MIP actions, including flying less and eating less meat
  + Lack of knowledge about how carbon offsets work
  + People overestimate the impact of low-impact behaviors, including recycling, replacing bulbs, and planting trees
- People underestimate how many people think they should adopt the behaviors
  + There is a large difference between the *perceived % of the population thinking people should adopt these behaviors* and the *actual % of the population thinking people should adopt the behaviors*

#### Program interest  
* Interest in one program is predictive of interest in another program
  + People that are interested in one program are also likely to be interested in another program
* Program interest is the highest for buying an EV, reducing food waste, and contracting for green energy
* Program interest is the lowest for installing solar, buying offsets, eating less meat, and flying less frequently
* Beliefs about what should be done and beliefs about what other's think should be done predict the interest
* Income does not predict program interest
* Ethnicity is a weak predictor of interest
* Education is predictive of program interest
  + This is especially true for those with graduate degrees
  + Education confounds the relationship between income and program interest (Once we add education into the linear regression, coefficients for income are reduced)
* Participation in and donation to religious groups is not correlated with program interest
* Participation in and donation to other social organizations is weakly correlated with program interest
* Being retired is negatively correlated with interest in programs and intention to adopt the behaviors

#### Intention to adopt
* Intention to adopt the behaviors is the highest for reducing food waste and flying less
* Intention to adopt is moderate for purchasing an EV, eating less meat, and contracting for green energy
* Intention to adopt is the lowest for offsets and solar panels
* Moderate correlations between various behaviors, suggesting that some behaviors could be offered in a bundle:
  + Buy an EV and buy offsets
  + Buy offsets and install solar
  + Eat less meat and reduce food waste
  + Contract for green energy and install solar
* All three social expectations are moderate predictors of intention to adopt the behaviors

### Results in Detail

#### Program Participation Interest

##### How interested would you be in participating in a program which helps you *[adopt behavior]*?
```{r, fig.width = 9, fig.height = 5, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
#Boxplot in violin

# Violin plot of interest in program
violin <- data %>% 
  select(wt,
         var96, #EV 
         var98, #Fly
         var100, #Offsets 
         var104, #PBD
         var106, #RECs
         var108, #Solar
         var110) #Foodwaste 

violin <- mutate_all(violin, function(x) as.numeric(as.character(x)))

violin_plot0 <- violin %>%
   pivot_longer(
   cols = starts_with(c("var")),
   names_to = "behavior",
   values_to = "value",
   values_drop_na = TRUE) %>% 
    mutate(behavior = recode(behavior, var96 = "Purchase \nan EV", var100 = "Purchase \ncarbon offsets", var106 = "Purchase green \nenergy", var108 = "Install solar \npanels", var98 = "Fly less", var104 = "Eat less meat", var110 = "Reduce food \nwaste"))

p <- ggplot(violin_plot0, aes(x = reorder(behavior, -value), y = value)) + 
  geom_violin()

p + geom_boxplot(width = 0.1, color = "grey") + 
  stat_summary(fun.y = median, geom = "point", size = 2, color = "red") + 
  theme(axis.line = element_line(color = "grey"),
        axis.ticks = element_line(color = "grey"),
        axis.title.y = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 11),
        axis.text.x = element_text(colour="black", size = 11),
        axis.text.y = element_text(colour="black", size = 11),
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "white"), 
        panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "grey"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill = NA, size = 0.5)) +
  labs(x = "",y = "Interest in a program which helps adopt behaviors") + 
scale_y_continuous(breaks= pretty_breaks())
```

```{r, fig.width = 9, fig.height = 5, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, eval = FALSE}
### Interest in program participation Unweighted

# Violin plot of interest in program
violin <- data %>% 
  select(var96, #EV 
         var98, #Fly
         var100, #Offsets 
         var104, #PBD
         var106, #RECs
         var108, #Solar
         var110) #Foodwaste 

dodge <- position_dodge(width = 1)

violin_plot <- violin %>%
    select(var96:var110) %>%
    gather(behavior, value) %>%
    mutate(behavior = recode(behavior, var96 = "Purchase an \nelectric car", var100 = "Purchase \ncarbon offsets", var106 = "Purchase green \nenergy", var108 = "Install solar \npanels", var98 = "Fly less", var104 = "Eat less meat", var110 = "Reduce food \nwaste")) %>%
  ggplot(aes(x = reorder(as_factor(behavior), -value), y = value, fill = value)) +
    geom_violin() +
  geom_boxplot(position = dodge, width = 0.1, color = "grey", alpha = 0.2, outlier.shape = NA) +
    stat_summary(fun.y = median, geom = "point", size = 2, color = "red") +
  theme(axis.line = element_line(color = "grey"),
        axis.ticks = element_line(color = "grey"),
        axis.title.y = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 11),
        axis.text.x = element_text(colour="black", size = 11),
        axis.text.y = element_text(colour="black", size = 11),
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "white"), 
        panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "grey"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill = NA, size = 0.5)) +
  #scale_y_continuous(labels = function(x) paste0(x,"%")) +
  labs(x ="",y = "Interest in a program which helps adopt behaviors")

violin_plot
#ggsave("violin_plot.png", units = "in", width = 8, height = 5, dpi = 300)
```

```{r, fig.width = 9, fig.height = 5, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, eval = FALSE}
### Interest in program participation Demo Weighted

# Violin plot of interest in program
violin <- data %>% 
  select(demo_weight,
         var96, #EV 
         var98, #Fly
         var100, #Offsets 
         var104, #PBD
         var106, #RECs
         var108, #Solar
         var110) #Foodwaste 

violin <- mutate_all(violin, function(x) as.numeric(as.character(x)))

dodge <- position_dodge(width = 1)

violin_plot1 <- violin %>%
   pivot_longer(
   cols = starts_with(c("var")),
   names_to = "behavior",
   values_to = "value",
   values_drop_na = TRUE) %>% 
    mutate(behavior = recode(behavior, var96 = "Purchase an \nelectric car", var100 = "Purchase \ncarbon offsets", var106 = "Purchase green \nenergy", var108 = "Install solar \npanels", var98 = "Fly less", var104 = "Eat less meat", var110 = "Reduce food \nwaste")) %>%
  ggplot(aes(x = reorder(as_factor(behavior), -value), y = value, fill = value, weight = demo_weight)) +
    geom_violin() +
  geom_boxplot(position = dodge, width = 0.1, color = "grey", alpha = 0.2, outlier.shape = NA) +
    stat_summary(fun.y = median, geom = "point", size = 2, color = "red") +
  theme(axis.line = element_line(color = "grey"),
        axis.ticks = element_line(color = "grey"),
        axis.title.y = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 11),
        axis.text.x = element_text(colour="black", size = 11),
        axis.text.y = element_text(colour="black", size = 11),
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "white"), 
        panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "grey"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill = NA, size = 0.5)) +
  #scale_y_continuous(labels = function(x) paste0(x,"%")) +
  labs(x ="",y = "Interest in a program which helps adopt behaviors")

violin_plot1

#ggsave("violin_plot.png", units = "in", width = 8, height = 5, dpi = 300)
```

```{r, fig.width = 9, fig.height = 5, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, eval = FALSE}
### Interest in program participation ZIP Weighted
# Violin plot of interest in program
violin <- data %>% 
  select(zip.weight,
         var96, #EV 
         var98, #Fly
         var100, #Offsets 
         var104, #PBD
         var106, #RECs
         var108, #Solar
         var110) #Foodwaste 

violin <- mutate_all(violin, function(x) as.numeric(as.character(x)))

dodge <- position_dodge(width = 1)

violin_plot2 <- violin %>%
   pivot_longer(
   cols = starts_with(c("var")),
   names_to = "behavior",
   values_to = "value",
   values_drop_na = TRUE) %>% 
    mutate(behavior = recode(behavior, var96 = "Purchase an \nelectric car", var100 = "Purchase \ncarbon offsets", var106 = "Purchase green \nenergy", var108 = "Install solar \npanels", var98 = "Fly less", var104 = "Eat less meat", var110 = "Reduce food \nwaste")) %>%
  ggplot(aes(x = reorder(as_factor(behavior), -value), y = value, fill = value, weight = zip.weight)) +
    geom_violin() +
  geom_boxplot(position = dodge, width = 0.1, color = "grey", alpha = 0.2, outlier.shape = NA) +
    stat_summary(fun.y = median, geom = "point", size = 2, color = "red") +
  theme(axis.line = element_line(color = "grey"),
        axis.ticks = element_line(color = "grey"),
        axis.title.y = element_text(color = "black", size = 11),
        axis.title.x = element_text(color = "black", size = 11),
        axis.text.x = element_text(colour="black", size = 11),
        axis.text.y = element_text(colour="black", size = 11),
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "white"), 
        panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "grey"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill = NA, size = 0.5)) +
  #scale_y_continuous(labels = function(x) paste0(x,"%")) +
  labs(x ="",y = "Interest in a program which helps adopt behaviors")

violin_plot2

#ggsave("violin_plot.png", units = "in", width = 8, height = 5, dpi = 300)
```

```{r, echo = FALSE, results = 'asis', message = FALSE}
## Index table
index <- data %>% 
  select(
  wt,
  Vrid,
  var13, #RID
  var83O227:var83O804, #ranking
  -var83O800, -var83O797, #remove buying used clothes & composting
  #EV
  var26, #adoption
  var87, #EE
  var28, #PNB,
  var88, #NE
  var94, #intent
  var96, #program interest
  #Fly
  var70, #Are you trying to fly less frequently than you used to?
  var69, #EE
  var38, #PNB
  var35, #NE
  var97, #intent
  var98, #program interest
  #Offsets
  var39, #adoption
  var40, #EE
  var41, #PNB
  var42, #NE
  var99, #intent
  var100, #program interest
  #PBD
  var71, #Are you trying to eat less meat than you used to?
  var115, #adoption % of meals
  var72, #EE
  var66, #PNB
  var48, #NE
  var103, #intent
  var104, #program interest
  #RECs
  var54, #adoption
  var55, #EE
  var56, #PNB
  var57, #NE
  var105, #intent
  var106, #program interest
  #Solar
  var59, #adoption
  var60, #EE
  var61, #PNB
  var62, #NE
  var107, #intent
  var108, #program interest
  #Food waste
  var73, #Are you currently trying to reduce the amount of food waste you produce?
  var74, #EE
  var75, #PNB
  var76, #NE
  var109, #intent
  var110 #program interest
  ) %>% 
  rename(
  offset_hrank = var83O227,
  ev_hrank = var83O794,
  recs_hrank = var83O796,
  solar_hrank = var83O793,
  pbd_hrank = var83O795,
  fly_hrank = var83O228,
  local_lrank = var83O798,
  bulbs_lrank = var83O799,
  fridge_lrank = var83O801,
  trees_lrank = var83O802,
  recycling_lrank = var83O803,
  pack_lrank = var83O804,
  #EV
  ev_adoption = var26,
  ev_ee = var87,
  ev_pnb = var28,
  ev_ne = var88,
  ev_intent = var94,
  ev_program_interest = var96,
  #Fly
  fly_adoption = var70, #trying to fly less
  fly_ee = var69, #EE
  fly_pnb = var38, #PNB
  fly_ne = var35, #NE
  fly_intent = var97,
  fly_program_interest = var98,
  #Offset
  offset_adoption = var39, #adoption
  offset_ee = var40, #EE
  offset_pnb = var41, #PNB
  offset_ne = var42, #NE
  offset_program_interest = var100, #program interest
  offset_intent = var99,
  #PBD
  pbd_adoption = var71, #trying to
  pbd_ee = var72, #EE
  pbd_pnb = var66, #PNB
  pbd_ne = var48, #NE
  pbd_program_interest = var104, #program interest
  pbd_intent = var103, 
  #RECs
  recs_adoption = var54, #adoption
  recs_ee = var55, #EE
  recs_pnb = var56, #PNB
  recs_ne = var57, #NE
  recs_program_interest = var106, #program interest
  recs_intent = var105,
  #Solar
  solar_adoption = var59, #adoption
  solar_ee = var60, #EE
  solar_pnb = var61, #PNB
  solar_ne = var62, #NE
  solar_program_interest = var108, #program interest
  solar_intent = var107,
  #Food waste
  foodwaste_adoption = var73, #attempt
  foodwaste_ee = var74, #EE
  foodwaste_pnb = var75, #PNB
  foodwaste_ne = var76, #NE
  foodwaste_program_interest = var110, #program interest
  foodwaste_intent = var109)

index <- index %>% 
  mutate(
  #Adoption
  ev_adoption = case_when(ev_adoption == 0 ~ 0, TRUE ~ 1), 
  recs_adoption = case_when(recs_adoption == 1 ~ 1, TRUE ~ 0),
  #EE
  ev_ee = ev_ee/10,
  fly_ee = fly_ee/10,
  solar_ee = solar_ee/10,
  recs_ee = recs_ee/10,
  offset_ee = offset_ee/10,
  foodwaste_ee = foodwaste_ee/10,
  pbd_ee = pbd_ee/10,
  #NE
  ev_ne = ev_ne/10,
  fly_ne = fly_ne/10,
  solar_ne = solar_ne/10,
  recs_ne = recs_ne/10,
  offset_ne = offset_ne/10,
  foodwaste_ne = foodwaste_ne/10,
  pbd_ne = pbd_ne/10,
  #Program interest
  ev_program_interest = ev_program_interest/10,
  fly_program_interest = fly_program_interest/10,
  solar_program_interest = solar_program_interest/10,
  recs_program_interest = recs_program_interest/10,
  offset_program_interest = offset_program_interest/10,
  foodwaste_program_interest = foodwaste_program_interest/10,
  pbd_program_interest = pbd_program_interest/10,
  #Intent
  ev_intent = ev_intent/100,
  fly_intent = fly_intent/100,
  solar_intent = solar_intent/100,
  recs_intent = recs_intent/100,
  offset_intent = offset_intent/100,
  foodwaste_intent = foodwaste_intent/100,
  pbd_intent = pbd_intent/100)

# ranking

df1 <- index %>% 
  select(Vrid:pack_lrank)

df1 = index %>% 
     transmute(Vrid, across(ends_with('hrank'), 
        ~  rowSums(. <  select(df1, ends_with('lrank'))), .names = '{.col}_rank'))

df1 <- mutate_all(df1, function(x) as.numeric(as.character(x)))

#

index_long <- index %>% 
  select(Vrid, wt, ev_adoption:foodwaste_program_interest)

index_long <- mutate_all(index_long, function(x) as.numeric(as.character(x)))

index_long <- left_join(index_long, df1, by = "Vrid")

index_long <- index_long %>%
 pivot_longer(
   cols = ends_with(c("intent", "program_interest", "ee", "pnb", "ne", "adoption", "rank")),
   names_to = "indicator",
   values_to = "value",
   values_drop_na = TRUE)

index_long <- index_long %>%
  mutate(behavior = indicator)

fin_table <- index_long %>% 
  mutate(behavior = sapply(strsplit(index_long$indicator, split='_', fixed=TRUE),function(x) (x[1])))

fin_table <- fin_table %>% 
  mutate(ind = sapply(strsplit(fin_table$indicator, split='_', fixed=TRUE),function(x) (x[2])))

t <- group_by(fin_table, behavior, ind)

t <- summarise(t, value.mean = mean(value, na.rm = TRUE))

t <- t %>% 
  group_by(behavior) %>% 
  pivot_wider(names_from = ind, values_from = value.mean)

t <- t %>% 
  mutate(hrank = hrank/6)
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
# Function by Greg Lin
# Notice bias here = a positive number. 
# Higher values give more widely spaced colors at the high end

make_color_pal <- function(colors, bias = 1) {
  get_color <- colorRamp(colors, bias = bias)
  function(x) rgb(get_color(x), maxColorValue = 255)
}

good_color <- make_color_pal(c("#ffffff", "#f2fbd2", "#c9ecb4", "#93d3ab", "#35b0ab"), bias = 2)

# Generate a vector of example numbers between 0 and 1
seq(0.1, 0.9, length.out = 12)
# [1] 0.1000000 0.1727273 0.2454545 0.3181818 0.3909091 0.4636364
# [7] 0.5363636 0.6090909 0.6818182 0.7545455 0.8272727 0.9000000
# create matching colors
good_color(seq(0.1, 0.9, length.out = 12))
# [1] "#E9F8CB" "#D9F2C0" "#C9ECB4" "#BDE6B2" "#B0E0AF" "#A4DAAD"
# [7] "#97D5AB" "#88CFAB" "#79C9AB" "#69C3AB" "#5ABDAB" "#4AB8AB"
# display the colors
seq(0.1, 0.9, length.out = 12) %>% 
  good_color() %>% 
  scales::show_col()
```

#### Boston Index

```{r, echo = FALSE, results = 'asis', message = FALSE}
### Boston Index (weighted by ZIP and age-sex-ethnicity)
t11 <- group_by(fin_table, behavior, ind)

t11 <- summarise(t11, w.mean = weighted.mean(value, wt, na.rm = TRUE))

t11 <- t11 %>% 
  group_by(behavior) %>% 
  pivot_wider(names_from = ind, values_from = w.mean)

t11 <- t11 %>% 
  mutate(hrank = hrank/6)

# Rename columns
t11 <- t11 %>% 
  rename('Behavior' = behavior,
         'Adoption' = adoption,
         'Intention' = intent,
         'Belief that others are engaging in the behavior' = ee,
         'Belief that others should engage in the behavior' = pnb,
         'Belief that others think people should engage in the behavior' = ne,
         'Program interest' = program,
         'Carbon impact ranking' = hrank)

# Rename rows
t11$Behavior[t11$Behavior == "ev"] <- "Purchase an EV"
t11$Behavior[t11$Behavior == "fly"] <- "Fly less"
t11$Behavior[t11$Behavior == "offset"] <- "Purchase carbon offsets"
t11$Behavior[t11$Behavior == "recs"] <- "Purchase green energy"
t11$Behavior[t11$Behavior == "solar"] <- "Install solar panels"
t11$Behavior[t11$Behavior == "pbd"] <- "Eat less meat"
t11$Behavior[t11$Behavior == "foodwaste"] <- "Waste less food"

t11 <- t11 %>% 
  select(Behavior, Adoption, Intention, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`, `Program interest`, `Carbon impact ranking`)

mip_boston_comparison <- t11 %>% select(Behavior, Adoption, Intention, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`)

write.csv(mip_boston_comparison, "mip_boston_comparison.csv")

tt = reactable(t11,
  style = list(fontSize = "12px"),
  defaultSortOrder = 'asc',
  defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = TRUE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = TRUE,
    # apply defaults
    # 100 px and align to center of column
    defaultColDef = colDef(
      align = "center",
      minWidth = 100),
  # Add theme for the top border
    theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )
    ),
  columns = list(
    Behavior = colDef(
      minWidth = 170,
      align = "left"),
    Adoption = colDef(
      style = function(value) {
    normalized <- (value - min(t11$Adoption)) / (max(t11$Adoption) - min(t11$Adoption))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    Intention = colDef(
      style = function(value) {
    normalized <- (value - min(t11$Intention)) / (max(t11$Intention) - min(t11$Intention))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    `Belief that others are engaging in the behavior` = colDef(
      style = function(value) {
    normalized <- (value - min(t11$`Belief that others are engaging in the behavior`)) / (max(t11$`Belief that others are engaging in the behavior`) - min(t11$`Belief that others are engaging in the behavior`))
    color <- good_color(normalized)
    list(background = color)
  },
      name = "Others have adopted",
      format = colFormat(digits = 2)),
    `Belief that others should engage in the behavior` = colDef(
       style = function(value) {
    normalized <- (value - min(t11$`Belief that others should engage in the behavior`)) / (max(t11$`Belief that others should engage in the behavior`) - min(t11$`Belief that others should engage in the behavior`))
    color <- good_color(normalized)
    list(background = color)
  },
      name = "Others should adopt",
      format = colFormat(digits = 2)),
    `Belief that others think people should engage in the behavior` = colDef(
      style = function(value) {
    normalized <- (value - min(t11$`Belief that others think people should engage in the behavior`)) / (max(t11$`Belief that others think people should engage in the behavior`) - min(t11$`Belief that others think people should engage in the behavior`))
    color <- good_color(normalized)
    list(background = color)
  },
      name = "Others think people should adopt",
      format = colFormat(digits = 2),
      minWidth = 120),
    `Program interest` = colDef(
      style = function(value) {
    normalized <- (value - min(t11$`Program interest`)) / (max(t11$`Program interest`) - min(t11$`Program interest`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 70),
    `Carbon impact ranking` = colDef(
      format = colFormat(digits = 2))),
  
  columnGroups = list(
    colGroup(name = "Beliefs that...", columns = c("Belief that others are engaging in the behavior", "Belief that others should engage in the behavior", "Belief that others think people should engage in the behavior"))))

div(
  class = "Behavior",
  div(
    # this can be called with CSS now via .title
    #class = "title",
    #h2("MIP Index: Boston"),
    "The survey was fielded from March 31 – April 21, 2021, drawing on the stratified sample of the Boston CBSA (n = 1,155)
    "
  ),
  # The actual table
  tt)
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE}
### Boston Index Unweighted
# Rename columns
t <- t %>% 
  rename('Behavior' = behavior,
         'Adoption' = adoption,
         'Intention' = intent,
         'Belief that others are engaging in the behavior' = ee,
         'Belief that others should engage in the behavior' = pnb,
         'Belief that others think people should engage in the behavior' = ne,
         'Program interest' = program,
         'Carbon impact ranking' = hrank)

# Rename rows
t$Behavior[t$Behavior == "ev"] <- "Purchase an EV"
t$Behavior[t$Behavior == "fly"] <- "Fly less*"
t$Behavior[t$Behavior == "offset"] <- "Purchase carbon offsets"
t$Behavior[t$Behavior == "recs"] <- "Purchase green energy"
t$Behavior[t$Behavior == "solar"] <- "Install solar panels"
t$Behavior[t$Behavior == "pbd"] <- "Eat less meat*"
t$Behavior[t$Behavior == "foodwaste"] <- "Waste less food*"

t <- t %>% 
  select(Behavior, Adoption, Intention, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`, `Program interest`, `Carbon impact ranking`)

reactable(t,
  columns = list(Adoption = colDef(format = colFormat(digits = 2), minWidth = 90),
                 Intention = colDef(format = colFormat(digits = 2), minWidth = 90),
                 `Belief that others are engaging in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Belief that others should engage in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Belief that others think people should engage in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Program interest` = colDef(format = colFormat(digits = 2)),
                 `Carbon impact ranking` = colDef(format = colFormat(digits = 2))),
  striped = TRUE,
  highlight = TRUE,
  bordered = TRUE,
  theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "8px 12px",
    style = list(fontFamily = "-apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif")))
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE, eval = FALSE}
### Boston Index Demo Weighted
t1 <- group_by(fin_table, behavior, ind)

t1 <- summarise(t1, w.mean = weighted.mean(value, demo_weight, na.rm = TRUE))

t1 <- t1 %>% 
  group_by(behavior) %>% 
  pivot_wider(names_from = ind, values_from = w.mean)

t1 <- t1 %>% 
  mutate(hrank = hrank/6)
# Rename columns
t1 <- t1 %>% 
  rename('Behavior' = behavior,
         'Adoption' = adoption,
         'Intention' = intent,
         'Belief that others are engaging in the behavior' = ee,
         'Belief that others should engage in the behavior' = pnb,
         'Belief that others think people should engage in the behavior' = ne,
         'Program interest' = program,
         'Carbon impact ranking' = hrank)

# Rename rows
t1$Behavior[t1$Behavior == "ev"] <- "Purchase an EV"
t1$Behavior[t1$Behavior == "fly"] <- "Fly less*"
t1$Behavior[t1$Behavior == "offset"] <- "Purchase carbon offsets"
t1$Behavior[t1$Behavior == "recs"] <- "Purchase green energy"
t1$Behavior[t1$Behavior == "solar"] <- "Install solar panels"
t1$Behavior[t1$Behavior == "pbd"] <- "Eat less meat*"
t1$Behavior[t1$Behavior == "foodwaste"] <- "Waste less food*"

t1 <- t1 %>% 
  select(Behavior, Adoption, Intention, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`, `Program interest`, `Carbon impact ranking`)

reactable(t1,
  columns = list(Adoption = colDef(format = colFormat(digits = 2), minWidth = 90),
                 Intention = colDef(format = colFormat(digits = 2), minWidth = 90),
                 `Belief that others are engaging in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Belief that others should engage in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Belief that others think people should engage in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Program interest` = colDef(format = colFormat(digits = 2)),
                 `Carbon impact ranking` = colDef(format = colFormat(digits = 2))),
  striped = TRUE,
  highlight = TRUE,
  bordered = TRUE,
  theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "8px 12px",
    style = list(fontFamily = "-apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif")))
```

```{r, echo = FALSE, include = FALSE, results = 'asis', message = FALSE, eval = FALSE}
### Boston Index ZIP weighted
t2 <- group_by(fin_table, behavior, ind)

t2 <- summarise(t2, w.mean = weighted.mean(value, zip.weight, na.rm = TRUE))

t2 <- t2 %>% 
  group_by(behavior) %>% 
  pivot_wider(names_from = ind, values_from = w.mean)

t2 <- t2 %>% 
  mutate(hrank = hrank/6)

# Rename columns
t2 <- t2 %>% 
  rename('Behavior' = behavior,
         'Adoption' = adoption,
         'Intention' = intent,
         'Belief that others are engaging in the behavior' = ee,
         'Belief that others should engage in the behavior' = pnb,
         'Belief that others think people should engage in the behavior' = ne,
         'Program interest' = program,
         'Carbon impact ranking' = hrank)

# Rename rows
t2$Behavior[t2$Behavior == "ev"] <- "Purchase an EV"
t2$Behavior[t2$Behavior == "fly"] <- "Fly less*"
t2$Behavior[t2$Behavior == "offset"] <- "Purchase carbon offsets"
t2$Behavior[t2$Behavior == "recs"] <- "Purchase green energy"
t2$Behavior[t2$Behavior == "solar"] <- "Install solar panels"
t2$Behavior[t2$Behavior == "pbd"] <- "Eat less meat*"
t2$Behavior[t2$Behavior == "foodwaste"] <- "Waste less food*"

t2 <- t2 %>% 
  select(Behavior, Adoption, Intention, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`, `Program interest`, `Carbon impact ranking`)

reactable(t2,
  columns = list(Adoption = colDef(format = colFormat(digits = 2), minWidth = 90),
                 Intention = colDef(format = colFormat(digits = 2), minWidth = 90),
                 `Belief that others are engaging in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Belief that others should engage in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Belief that others think people should engage in the behavior` = colDef(format = colFormat(digits = 2), minWidth = 140),
                 `Program interest` = colDef(format = colFormat(digits = 2)),
                 `Carbon impact ranking` = colDef(format = colFormat(digits = 2))),
  striped = TRUE,
  highlight = TRUE,
  bordered = TRUE,
  theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "8px 12px",
    style = list(fontFamily = "-apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif")))
```

For eating less meat, flying less, and reducing food waste, adoption variable measured current attempt, rather than reported adoption (e.g., *Are you trying to fly less frequently than you used to?*)

#### Carbon Impact Ranking

The table below presents the average ranking in terms of the carbon mitigation potential of MIP (highlighted) and low-impact behaviors assigned by participants. For example, on average, installing rooftop solar was assigned rank 4.61 out of 12.

```{r, echo = FALSE, results = 'asis', message = FALSE, fig.align = 'center'}
#Ranking table
ranking_table <- index %>% 
  select(Vrid, offset_hrank:pack_lrank) %>% 
  pivot_longer(
   cols = ends_with(c("rank")),
   names_to = "behavior",
   values_to = "value",
   values_drop_na = TRUE) %>%
  group_by(behavior) %>% 
  summarise(mean = mean(value))

# Rename columns
ranking_table <- ranking_table %>% 
  rename('Behavior' = behavior,
         'Average position' = mean)

# Rename rows
ranking_table$Behavior[ranking_table$Behavior == "solar_hrank"] <- "Get 100% of electricity from solar panels on the roof instead of from the grid for one year"
ranking_table$Behavior[ranking_table$Behavior == "recycling_lrank"] <- "Recycle 100% of recyclable materials generated as waste, including newspaper, magazines, glass, plastic, and metal for one year"
ranking_table$Behavior[ranking_table$Behavior == "recs_hrank"] <- "Purchase 100% of household energy from renewable sources for one year"
ranking_table$Behavior[ranking_table$Behavior == "ev_hrank"] <- "Drive a fully electric car for one year"
ranking_table$Behavior[ranking_table$Behavior == "trees_lrank"] <- "Plant 10 trees"
ranking_table$Behavior[ranking_table$Behavior == "bulbs_lrank"] <- "Replace 25 incandescent light bulbs with ENERGY STAR lights"
ranking_table$Behavior[ranking_table$Behavior == "fridge_lrank"] <- "Replace old refrigerator with ENERGY STAR refrigerator"
ranking_table$Behavior[ranking_table$Behavior == "offset_hrank"] <- "Purchase carbon offsets to offset average American’s annual carbon footprint"
ranking_table$Behavior[ranking_table$Behavior == "pack_lrank"] <- "Eliminate all food packaging for one year"
ranking_table$Behavior[ranking_table$Behavior == "local_lrank"] <- "Source all of food locally for one year"
ranking_table$Behavior[ranking_table$Behavior == "fly_hrank"] <- "Take one fewer round-trip flight"
ranking_table$Behavior[ranking_table$Behavior == "pbd_hrank"] <- "Avoid eating all meat for one year"

ranking_t = reactable(ranking_table,
  style = list(fontSize = "12px"),
  defaultPageSize = 12,
  defaultSortOrder = 'asc',
  defaultSorted = 'Average position',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = FALSE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = FALSE,
    # apply defaults
    # 100 px and align to center of column
    defaultColDef = colDef(
      align = "center",
      minWidth = 100),
  # Add theme for the top border
    theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )
    ),
  columns = list(
    Behavior = colDef(
      minWidth = 490,
      align = "left"),
    `Average position` = colDef(
      name = "Average position",
      format = colFormat(digits = 2),
      maxWidth = 100)),
  rowStyle = function(index) {
  if (index == 2 | index == 3 | index == 6 | index == 8 |index == 9| index == 11) list(background = "#E9F8CB")
})

ranking_t
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
ev_cols <- c("EV: PI", "EV: Intent", "EV: Beliefs that others have adopted", "Beliefs that others should drive an EV", "Beliefs that others think people should drive an EV")



#social_cols <- c("EV: Beliefs that others have adopted", "EV: Beliefs that others should adopt", "EV: Beliefs that others think people should adopt")

BuYlRd <- function(x) rgb(colorRamp(c("#7fb7d7", "#ffffbf", "#fc8d59"))(x), maxColorValue = 255)
```

#### Correlation tables

```{r, echo = FALSE, results = 'asis', message = FALSE, fig.align = 'center', warning = FALSE, include = FALSE}
#Corr between intention to adopt and program interest 
cor_table_1 <- data %>% 
  select(
  #Vrid,
  #var13, #RID
  #EV
  var94, #intent
  var96, #program interest
  #Fly
  var97, #intent
  var98, #program interest
  #Offsets
  var99, #intent
  var100, #program interest
  #PBD
  var103, #intent
  var104, #program interest
  #RECs
  var105, #intent
  var106, #program interest
  #Solar
  var107, #intent
  var108, #program interest
  #Food waste
  var109, #intent
  var110 #program interest
  ) %>% 
  rename(
  #EV
  "I: EV" = var94,
  "PI: EV" = var96,
  #Fly
  "I: Fly" = var97,
  "PI: Fly" = var98,
  #Offset
  "PI: Offsets" = var100, #program interest
  "I: Offsets" = var99,
  #PBD
  "PI: PBD" = var104, #program interest
  "I: PBD" = var103, 
  #RECs
  "PI: RECs" = var106, #program interest
  "I: RECs" = var105,
  #Solar
  "PI: Solar" = var108, #program interest
  "I: Solar" = var107,
  #Food waste
  "PI: Food Waste" = var110, #program interest
  "I: Food Waste" = var109)

res <- cor(cor_table_1)
res <- round(res, 2)
res <- as.data.frame(res)
#upper.tri(res, diag = FALSE)
#upper <- res
#upper[upper.tri(res)] <- ""
#upper < -as.data.frame(res)
#upper

res_table1 <- reactable(res,
  style = list(fontSize = "11px"),
  defaultPageSize = 14,
  #defaultSortOrder = 'asc',
  #defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = TRUE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = TRUE,
    # Add theme for the top border
    theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )
    ),
  columns = list(
    `I: EV` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`I: EV`)) / (max(res$`I: EV`) - min(res$`I: EV`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    `PI: EV` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`PI: EV`)) / (max(res$`PI: EV`) - min(res$`PI: EV`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    `I: Fly` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`I: Fly`)) / (max(res$`I: Fly`) - min(res$`I: Fly`))
    color <- good_color(normalized)
    list(background = color)
  },
  maxWidth = 65,
      format = colFormat(digits = 2)),
    `PI: Fly` = colDef(
       style = function(value) {
    normalized <- (value - min(res$`PI: Fly`)) / (max(res$`PI: Fly`) - min(res$`PI: Fly`))
    color <- good_color(normalized)
    list(background = color)
  },
      maxWidth = 65,
      format = colFormat(digits = 2)),
    `I: Solar` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`I: Solar`)) / (max(res$`I: Solar`) - min(res$`I: Solar`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    `PI: Solar` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`PI: Solar`)) / (max(res$`PI: Solar`) - min(res$`PI: Solar`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    `I: Offsets` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`I: Offsets`)) / (max(res$`I: Offsets`) - min(res$`I: Offsets`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    `PI: Offsets` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`PI: Offsets`)) / (max(res$`PI: Offsets`) - min(res$`PI: Offsets`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 70),
    `I: PBD` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`I: PBD`)) / (max(res$`I: PBD`) - min(res$`I: PBD`))
    color <- good_color(normalized)
    list(background = color)
  },
      maxWidth = 65,
      format = colFormat(digits = 2)),
    `PI: PBD` = colDef(
       style = function(value) {
    normalized <- (value - min(res$`PI: PBD`)) / (max(res$`PI: PBD`) - min(res$`PI: PBD`))
    color <- good_color(normalized)
    list(background = color)
  },
      maxWidth = 65,
      format = colFormat(digits = 2)),
    `I: RECs` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`I: RECs`)) / (max(res$`I: RECs`) - min(res$`I: RECs`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
    `PI: RECs` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`PI: RECs`)) / (max(res$`PI: RECs`) - min(res$`PI: RECs`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 65),
      `I: Food Waste` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`I: Food Waste`)) / (max(res$`I: Food Waste`) - min(res$`I: Food Waste`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 90),
    `PI: Food Waste` = colDef(
      style = function(value) {
    normalized <- (value - min(res$`PI: Food Waste`)) / (max(res$`PI: Food Waste`) - min(res$`PI: Food Waste`))
    color <- good_color(normalized)
    list(background = color)
  },
      format = colFormat(digits = 2),
      maxWidth = 95)))

res_table1
```

##### Pearson correlations between reported intention to engage in the behaviors

```{r, echo = FALSE, results = 'asis', message = FALSE, fig.align = 'center', warning = FALSE}
#Corr between intention to adopt and program interest 
intention_table <- data %>% 
  select(
  #Vrid,
  #var13, #RID
  #EV
  var94, #intent
  #Fly
  var97, #intent
  #Offsets
  var99, #intent
  #PBD
  var103, #intent
  #RECs
  var105, #intent
  #Solar
  var107, #intent
  #Food waste
  var109, #intent
  ) %>% 
  rename(
  #EV
  "Intention to drive an EV" = var94,
  #Fly
  "Intention to fly less" = var97,
  #Offset
  "Intention to buy offsets" = var99,
  #PBD
  "Intention to eat less meat" = var103, 
  #RECs
  "Intention to contract for green energy" = var105,
  #Solar
  "Intention to install solar" = var107,
  #Food waste
  "Intention to reduce food waste" = var109)

intention_table <- cor(intention_table)
intention_table <- round(intention_table, 2)
intention_table <- as.data.frame(intention_table)

intention_reactable = reactable(intention_table,
  defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
      normalized <- (value - min(intention_table)) / (max(intention_table) - min(intention_table))
      color <- BuYlRd(normalized)
      list(background = color)
    },
    format = colFormat(digits = 2),
  ),
  style = list(fontSize = "11px"),
  defaultPageSize = 30,
  #defaultSortOrder = 'asc',
  #defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = TRUE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = TRUE,
    # Add theme for the top border
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

intention_reactable
```

##### Pearson correlations between interest in programs that help adopt the behaviors

```{r, echo = FALSE, results = 'asis', message = FALSE, fig.align = 'center', warning = FALSE}
#Corr between intention to adopt and program interest 
interest_table <- data %>% 
  select(
  #Vrid,
  #var13, #RID
  #EV
  var96, #program interest
  #Fly
  var98, #program interest
  #Offsets
  var100, #program interest
  #PBD
  var104, #program interest
  #RECs
  var106, #program interest
  #Solar
  var108, #program interest
  #Food waste
  var110 #program interest
  ) %>% 
  rename(
  #EV
  "Interest in EV program" = var96,
  #Fly
  "Interest in fly less program" = var98,
  #Offset
  "Interest in offsets program" = var100, #program interest
  #PBD
  "Interest in eat less meat program" = var104, #program interest
  #RECs
  "Interest in green energy program" = var106, #program interest
  #Solar
  "Interest in solar program" = var108, #program interest
  #Food waste
  "Interest in reducing food waste program" = var110)

interest_table <- cor(interest_table)
interest_table <- round(interest_table, 2)
interest_table <- as.data.frame(interest_table)

interest_reactable = reactable(interest_table,
  defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
      normalized <- (value - min(interest_table)) / (max(interest_table) - min(interest_table))
      color <- BuYlRd(normalized)
      list(background = color)
    },
    format = colFormat(digits = 2),
  ),
  style = list(fontSize = "11px"),
  defaultPageSize = 30,
  #defaultSortOrder = 'asc',
  #defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = TRUE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = TRUE,
    # Add theme for the top border
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

interest_reactable
```

##### Pearson correlations between demographic and psychographic predictors and behavior-related variables

```{r, echo = FALSE, results = 'asis', message = FALSE, fig.align = 'center', warning = FALSE, eval = FALSE}
#Corr table 2
corr_table_2 <- data %>% 
  select(
  #wt,
  #Vrid,
  #var13, #RID
  #EV
  #var26, #adoption
  var87, #EE
  var28, #PNB,
  var88, #NE
  var94, #intent
  var96, #program interest
  #Fly
  #var70, #Are you trying to fly less frequently than you used to?
  var69, #EE
  var38, #PNB
  var35, #NE
  var97, #intent
  var98, #program interest
  #Offsets
  #var39, #adoption
  var40, #EE
  var41, #PNB
  var42, #NE
  var99, #intent
  var100, #program interest
  #PBD
  #var71, #Are you trying to eat less meat than you used to?
  #var115, #adoption % of meals
  var72, #EE
  var66, #PNB
  var48, #NE
  var103, #intent
  var104, #program interest
  #RECs
  #var54, #adoption
  var55, #EE
  var56, #PNB
  var57, #NE
  var105, #intent
  var106, #program interest
  #Solar
  #var59, #adoption
  var60, #EE
  var61, #PNB
  var62, #NE
  var107, #intent
  var108, #program interest
  #Food waste
  #var73, #Are you currently trying to reduce the amount of food waste you produce?
  var74, #EE
  var75, #PNB
  var76, #NE
  var109, #intent
  var110, #program interest
  #demographics
  age_group,
  sex,
  ethnicity,
  var20, #politics
  var19, #income
  var17, #education
  #employment info
  var92, #empl status
  var93, #empl sector
  var102, #empl size
  #social participation & donation
  var118O832:var119O841) %>% 
  rename(
  #EV
  #ev_adoption = var26,
  ev_ee = var87,
  ev_pnb = var28,
  ev_ne = var88,
  ev_intent = var94,
  ev_program_interest = var96,
  #Fly
  #fly_adoption = var70, #trying to fly less
  fly_ee = var69, #EE
  fly_pnb = var38, #PNB
  fly_ne = var35, #NE
  fly_intent = var97,
  fly_program_interest = var98,
  #Offset
  #offset_adoption = var39, #adoption
  offset_ee = var40, #EE
  offset_pnb = var41, #PNB
  offset_ne = var42, #NE
  offset_program_interest = var100, #program interest
  offset_intent = var99,
  #PBD
  #pbd_adoption = var71, #trying to
  pbd_ee = var72, #EE
  pbd_pnb = var66, #PNB
  pbd_ne = var48, #NE
  pbd_program_interest = var104, #program interest
  pbd_intent = var103, 
  #RECs
  #recs_adoption = var54, #adoption
  recs_ee = var55, #EE
  recs_pnb = var56, #PNB
  recs_ne = var57, #NE
  recs_program_interest = var106, #program interest
  recs_intent = var105,
  #Solar
  #solar_adoption = var59, #adoption
  solar_ee = var60, #EE
  solar_pnb = var61, #PNB
  solar_ne = var62, #NE
  solar_program_interest = var108, #program interest
  solar_intent = var107,
  #Food waste
  #foodwaste_adoption = var73, #attempt
  foodwaste_ee = var74, #EE
  foodwaste_pnb = var75, #PNB
  foodwaste_ne = var76, #NE
  foodwaste_program_interest = var110, #program interest
  foodwaste_intent = var109,
  #dem
  politics = var20,
  income = var19, 
  education = var17,
  #employment info
  employment_status = var92, #empl status
  employment_sector = var93, #empl sector
  company_size = var102, #empl size
  #social participation
  part_religion = var118O832,
  part_school = var118O833,
  part_alumni = var118O834,
  part_neighbor = var118O835,
  part_none = var118O836,
  #social donation
  donation_religion = var119O837,
  donation_school = var119O838,
  donation_alumni = var119O839,
  donation_neighbor = var119O840,
  donate_none = var119O841) 

corr_table_2 <- dummy_cols(corr_table_2, select_columns = c("sex", "ethnicity", "age_group", "employment_status", "employment_sector"))

corr_table_2 <- data.frame(lapply(corr_table_2, function(x) as.numeric(as.character(x))))

corr_table_2 <- corr_table_2 %>% 
  select(ev_ee:foodwaste_program_interest, politics:education, company_size:age_group_65.:employment_status_10792, employment_sector_10492, employment_sector_10496, employment_sector_10499)

corr_table_2 <- corr_table_2 %>% 
  mutate(
    income = case_when(income == 10063 ~ 11, TRUE ~ income))

res.cor2 <- correlate(corr_table_2)

res.cor2$term[res.cor2$term == "income"] <- "Household income"
res.cor2$term[res.cor2$term == "age_group_18.24"] <- "Age: 18-24"
res.cor2$term[res.cor2$term == "age_group_25.34"] <- "Age: 25-34"
res.cor2$term[res.cor2$term == "age_group_35.44"] <- "Age: 35-44"
res.cor2$term[res.cor2$term == "age_group_45.54"] <- "Age: 45-54"
res.cor2$term[res.cor2$term == "age_group_55.64"] <- "Age: 55-64"
res.cor2$term[res.cor2$term == "age_group_65."] <- "Age: 65+"
res.cor2$term[res.cor2$term == "sex_Female"] <- "Female"
res.cor2$term[res.cor2$term == "sex_Male"] <- "Male"

res.cor2$term[res.cor2$term == "ethnicity_White"] <- "Ethnicity: White"
res.cor2$term[res.cor2$term == "ethnicity_Black"] <- "Ethnicity: Black"
res.cor2$term[res.cor2$term == "ethnicity_Asian"] <- "Ethnicity: Asian"
res.cor2$term[res.cor2$term == "ethnicity_Other"] <- "Ethnicity: Other"

res.cor2$term[res.cor2$term == "education"] <- "Education level"
res.cor2$term[res.cor2$term == "politics"] <- "Political orientation: Conservative"

res.cor2$term[res.cor2$term == "employment_status_10485"] <- "Employed"
res.cor2$term[res.cor2$term == "employment_status_10792"] <- "Retired"
res.cor2$term[res.cor2$term == "employment_status_10487"] <- "Unemployed"

res.cor2$term[res.cor2$term == "company_size"] <- "Employer size"
res.cor2$term[res.cor2$term == "employment_sector_10499"] <- "Industry: Technology/ Software"
res.cor2$term[res.cor2$term == "employment_sector_10496"] <- "Industry: Healthcare"
res.cor2$term[res.cor2$term == "employment_sector_10492"] <- "Industry: Education"

res.cor2$term[res.cor2$term == "part_religion"] <- "Participation: Religious Group"
res.cor2$term[res.cor2$term == "part_school"] <- "Participation: School Association"
res.cor2$term[res.cor2$term == "part_alumni"] <- "Participation: Alumni Group"
res.cor2$term[res.cor2$term == "part_neighbor"] <- "Participation: Neighborhood Org"

res.cor2$term[res.cor2$term == "donation_religion"] <- "Past Donation: Religious Group"
res.cor2$term[res.cor2$term == "donation_school"] <- "Past Donation: School Association"
res.cor2$term[res.cor2$term == "donation_alumni"] <- "Past Donation: Alumni Group"
res.cor2$term[res.cor2$term == "donation_neighbor"] <- "Past Donation: Neighborhood Org"

res.cor2 <- res.cor2 %>% mutate_if(is.numeric, round, digits = 2)

res.cor2[is.na(res.cor2)] <- 0

x2 <- c("Age: 18-24", "Age: 25-34", "Age: 35-44", "Age: 45-54", "Age: 55-64", "Age: 65+",
        "Female", "Male", 
        "Ethnicity: White", "Ethnicity: Black", "Ethnicity: Asian", "Ethnicity: Other", "Household income", "Education level", "Political orientation: Conservative", 
        "Employed", "Retired", "Unemployed", "Company Size", "Industry: Technology/ Software", "Industry: Healthcare", "Industry: Education", 
        "Participation: Religious Group", "Participation: School Association", "Participation: Alumni Group", "Participation: Neighborhood Org", "Past Donation: Religious Group", "Past Donation: School Association", "Past Donation: Alumni Group", "Past Donation: Neighborhood Org")

tt3 = res.cor2 %>% 
  focus(ev_program_interest, ev_intent, ev_ee, ev_pnb, ev_ne,
        solar_program_interest, solar_intent, solar_ee, solar_pnb, solar_ne,
        recs_program_interest, recs_intent, recs_ee, recs_pnb, recs_ne,
        offset_program_interest, offset_intent, offset_ee, offset_pnb, offset_ne,
        fly_program_interest, fly_intent, fly_ee, fly_pnb, fly_ne, 
        pbd_program_interest, pbd_intent, pbd_ee, pbd_pnb, pbd_ne,
        foodwaste_program_interest, foodwaste_intent, foodwaste_ee, foodwaste_pnb, foodwaste_ne) %>% 
  rename('Predictor' = term,
         'Interest in EV program' = ev_program_interest,
         'Intention to buy an EV' = ev_intent,
         'Beliefs that others drive an EV' = ev_ee,
         'Beliefs that others should drive an EV' = ev_pnb,
         'Beliefs that others think people should drive an EV' = ev_ne,
         'Interest in solar program' = solar_program_interest,
         'Intention to install solar' = solar_intent,
         'Beliefs that others have solar' = solar_ee,
         'Beliefs that others should install solar' = solar_pnb,
         'Beliefs that others think people should install solar' = solar_ne,
         'Interest in green energy program' = recs_program_interest,
         'Intention to contract for green energy' = recs_intent,
         'Beliefs that others have green energy' = recs_ee,
         'Beliefs that others should have green energy' = recs_pnb,
         'Beliefs that others think people should have green energy' = recs_ne,
         'Interest in offsets program' = offset_program_interest,
         'Intention to buy offsets' = offset_intent,
         'Beliefs that others bought offsets' = offset_ee,
         'Beliefs that others should buy offsets' = offset_pnb,
         'Beliefs that others think people should buy offsets' = offset_ne,
         'Interest in flying less program' = fly_program_interest,
         'Intention to fly less' = fly_intent,
         'Beliefs that others are flying less' = fly_ee,
         'Beliefs that others should fly less' = fly_pnb,
         'Beliefs that others think people should fly less' = fly_ne,
         'Interest in eating less meat program' = pbd_program_interest,
         'Intention to eat less meat' = pbd_intent,
         'Beliefs that others eat less meat' = pbd_ee,
         'Beliefs that others should eat less meat' = pbd_pnb,
         'Beliefs that others think people should eat less meat' = pbd_ne,
         'Interest in reducing food waste program' = foodwaste_program_interest,
         'Intention to reduce food waste' = foodwaste_intent,
         'Beliefs that others reduce food waste' = foodwaste_ee,
         'Beliefs that others should reduce food waste' = foodwaste_pnb,
         'Beliefs that others think people should reduce food waste' = foodwaste_ne) %>%
  slice(match(x2, Predictor)) #%>% #reorder predictors

sticky_style <- list(position = "sticky", left = 0, background = "#fff", zIndex = 1,
                     borderRight = "1px solid #eee")

tt5 = reactable(tt3,
                height = 500,
  defaultColDef = colDef(
    footer = function(values, name) htmltools::div(name, style = list(fontWeight = 600)),
    style = function(value) {
      if (!is.numeric(value)) return()
      normalized <- (value - min(tt3[-1])) / (max(tt3[-1]) - min(tt3[-1]))
      color <- BuYlRd(normalized)
      list(background = color)
    },
    format = colFormat(digits = 2),
  ),
  style = list(fontSize = "11px"),
  defaultPageSize = 30,
  #defaultSortOrder = 'asc',
  #defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = TRUE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = TRUE,
    # Add theme for the top border
  columns = list(
  `Predictor` =  colDef(
      style = sticky_style,
      headerStyle = sticky_style,
      minWidth = 120),
  `Beliefs that others think people should drive an EV` = colDef(
minWidth = 120),
    `Beliefs that others think people should install solar` = colDef(
minWidth = 120),
    `Beliefs that others think people should have green energy` = colDef(
      minWidth = 120),
    `Beliefs that others think people should eat less meat` = colDef(
minWidth = 120),
    `Beliefs that others think people should reduce food waste` = colDef(
      minWidth = 120)
  ),  
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

tt5
```

```{r, echo = FALSE, results = 'asis', message = FALSE, fig.align = 'center', warning = FALSE}
#Corr table 3
corr_table_2 <- data %>% 
  select(
  #wt,
  #Vrid,
  #var13, #RID
  #EV
  #var26, #adoption
  var87, #EE
  var28, #PNB,
  var88, #NE
  var94, #intent
  var96, #program interest
  #Fly
  #var70, #Are you trying to fly less frequently than you used to?
  var69, #EE
  var38, #PNB
  var35, #NE
  var97, #intent
  var98, #program interest
  #Offsets
  #var39, #adoption
  var40, #EE
  var41, #PNB
  var42, #NE
  var99, #intent
  var100, #program interest
  #PBD
  #var71, #Are you trying to eat less meat than you used to?
  #var115, #adoption % of meals
  var72, #EE
  var66, #PNB
  var48, #NE
  var103, #intent
  var104, #program interest
  #RECs
  #var54, #adoption
  var55, #EE
  var56, #PNB
  var57, #NE
  var105, #intent
  var106, #program interest
  #Solar
  #var59, #adoption
  var60, #EE
  var61, #PNB
  var62, #NE
  var107, #intent
  var108, #program interest
  #Food waste
  #var73, #Are you currently trying to reduce the amount of food waste you produce?
  var74, #EE
  var75, #PNB
  var76, #NE
  var109, #intent
  var110, #program interest
  #demographics
  age_group,
  sex,
  ethnicity,
  var20, #politics
  var19, #income
  var17, #education
  #employment info
  var92, #empl status
  var93, #empl sector
  var102, #empl size
  #social participation & donation
  var118O832:var119O841) %>% 
  rename(
  #EV
  #ev_adoption = var26,
  ev_ee = var87,
  ev_pnb = var28,
  ev_ne = var88,
  ev_intent = var94,
  ev_program_interest = var96,
  #Fly
  #fly_adoption = var70, #trying to fly less
  fly_ee = var69, #EE
  fly_pnb = var38, #PNB
  fly_ne = var35, #NE
  fly_intent = var97,
  fly_program_interest = var98,
  #Offset
  #offset_adoption = var39, #adoption
  offset_ee = var40, #EE
  offset_pnb = var41, #PNB
  offset_ne = var42, #NE
  offset_program_interest = var100, #program interest
  offset_intent = var99,
  #PBD
  #pbd_adoption = var71, #trying to
  pbd_ee = var72, #EE
  pbd_pnb = var66, #PNB
  pbd_ne = var48, #NE
  pbd_program_interest = var104, #program interest
  pbd_intent = var103, 
  #RECs
  #recs_adoption = var54, #adoption
  recs_ee = var55, #EE
  recs_pnb = var56, #PNB
  recs_ne = var57, #NE
  recs_program_interest = var106, #program interest
  recs_intent = var105,
  #Solar
  #solar_adoption = var59, #adoption
  solar_ee = var60, #EE
  solar_pnb = var61, #PNB
  solar_ne = var62, #NE
  solar_program_interest = var108, #program interest
  solar_intent = var107,
  #Food waste
  #foodwaste_adoption = var73, #attempt
  foodwaste_ee = var74, #EE
  foodwaste_pnb = var75, #PNB
  foodwaste_ne = var76, #NE
  foodwaste_program_interest = var110, #program interest
  foodwaste_intent = var109,
  #dem
  politics = var20,
  income = var19, 
  education = var17,
  #employment info
  employment_status = var92, #empl status
  employment_sector = var93, #empl sector
  company_size = var102, #empl size
  #social participation
  part_religion = var118O832,
  part_school = var118O833,
  part_alumni = var118O834,
  part_neighbor = var118O835,
  part_none = var118O836,
  #social donation
  donation_religion = var119O837,
  donation_school = var119O838,
  donation_alumni = var119O839,
  donation_neighbor = var119O840,
  donate_none = var119O841) 

corr_table_2 <- dummy_cols(corr_table_2, select_columns = c("sex", "ethnicity", "age_group", "employment_status", "employment_sector"))

corr_table_2 <- data.frame(lapply(corr_table_2, function(x) as.numeric(as.character(x))))

corr_table_2 <- corr_table_2 %>% 
  select(ev_ee:foodwaste_program_interest, politics:education, company_size:age_group_65.:employment_status_10792, employment_sector_10492, employment_sector_10496, employment_sector_10499)

corr_table_2 <- corr_table_2 %>% 
  mutate(
    income = case_when(income == 10063 ~ 11, TRUE ~ income))

res.cor2 <- correlate(corr_table_2)

res.cor2$term[res.cor2$term == "income"] <- "Household income"
res.cor2$term[res.cor2$term == "age_group_18.24"] <- "Age: 18-24"
res.cor2$term[res.cor2$term == "age_group_25.34"] <- "Age: 25-34"
res.cor2$term[res.cor2$term == "age_group_35.44"] <- "Age: 35-44"
res.cor2$term[res.cor2$term == "age_group_45.54"] <- "Age: 45-54"
res.cor2$term[res.cor2$term == "age_group_55.64"] <- "Age: 55-64"
res.cor2$term[res.cor2$term == "age_group_65."] <- "Age: 65+"
res.cor2$term[res.cor2$term == "sex_Female"] <- "Female"
res.cor2$term[res.cor2$term == "sex_Male"] <- "Male"

res.cor2$term[res.cor2$term == "ethnicity_White"] <- "Ethnicity: White"
res.cor2$term[res.cor2$term == "ethnicity_Black"] <- "Ethnicity: Black"
res.cor2$term[res.cor2$term == "ethnicity_Asian"] <- "Ethnicity: Asian"
res.cor2$term[res.cor2$term == "ethnicity_Other"] <- "Ethnicity: Other"

res.cor2$term[res.cor2$term == "education"] <- "Education level"
res.cor2$term[res.cor2$term == "politics"] <- "Political orientation: Conservative"

res.cor2$term[res.cor2$term == "employment_status_10485"] <- "Employed"
res.cor2$term[res.cor2$term == "employment_status_10792"] <- "Retired"
res.cor2$term[res.cor2$term == "employment_status_10487"] <- "Unemployed"

res.cor2$term[res.cor2$term == "company_size"] <- "Employer size"
res.cor2$term[res.cor2$term == "employment_sector_10499"] <- "Industry: Technology/ Software"
res.cor2$term[res.cor2$term == "employment_sector_10496"] <- "Industry: Healthcare"
res.cor2$term[res.cor2$term == "employment_sector_10492"] <- "Industry: Education"

res.cor2$term[res.cor2$term == "part_religion"] <- "Participation: Religious Group"
res.cor2$term[res.cor2$term == "part_school"] <- "Participation: School Association"
res.cor2$term[res.cor2$term == "part_alumni"] <- "Participation: Alumni Group"
res.cor2$term[res.cor2$term == "part_neighbor"] <- "Participation: Neighborhood Org"

res.cor2$term[res.cor2$term == "donation_religion"] <- "Past Donation: Religious Group"
res.cor2$term[res.cor2$term == "donation_school"] <- "Past Donation: School Association"
res.cor2$term[res.cor2$term == "donation_alumni"] <- "Past Donation: Alumni Group"
res.cor2$term[res.cor2$term == "donation_neighbor"] <- "Past Donation: Neighborhood Org"

res.cor2 <- res.cor2 %>% mutate_if(is.numeric, round, digits = 2)

res.cor2[is.na(res.cor2)] <- 0

x2 <- c("Age: 18-24", "Age: 25-34", "Age: 35-44", "Age: 45-54", "Age: 55-64", "Age: 65+",
        "Female", "Male", 
        "Ethnicity: White", "Ethnicity: Black", "Ethnicity: Asian", "Ethnicity: Other", "Household income", "Education level", "Political orientation: Conservative", 
        "Employed", "Retired", "Unemployed", "Company Size", "Industry: Technology/ Software", "Industry: Healthcare", "Industry: Education", 
        "Participation: Religious Group", "Participation: School Association", "Participation: Alumni Group", "Participation: Neighborhood Org", "Past Donation: Religious Group", "Past Donation: School Association", "Past Donation: Alumni Group", "Past Donation: Neighborhood Org")

tt3 = res.cor2 %>% 
  focus(ev_program_interest, solar_program_interest, recs_program_interest, offset_program_interest, fly_program_interest, pbd_program_interest, foodwaste_program_interest,
        ev_intent, solar_intent, recs_intent, offset_intent, fly_intent, pbd_intent, foodwaste_intent, 
        ev_ee, solar_ee, recs_ee, offset_ee, fly_ee, pbd_ee, foodwaste_ee,
        ev_pnb, solar_pnb, recs_pnb, offset_pnb, fly_pnb, pbd_pnb, foodwaste_pnb, 
        ev_ne,
        solar_ne,
        recs_ne,
        offset_ne,
        fly_ne, 
        pbd_ne,
        foodwaste_ne) %>% 
  rename('Predictor' = term,
         'Interest in EV program' = ev_program_interest,
         'Interest in solar program' = solar_program_interest,
         'Interest in green energy program' = recs_program_interest,
         'Interest in offsets program' = offset_program_interest,
         'Interest in flying less program' = fly_program_interest,
         'Interest in eating less meat program' = pbd_program_interest,
         'Interest in reducing food waste program' = foodwaste_program_interest,
         
         'Intention to buy an EV' = ev_intent,
         'Intention to install solar' = solar_intent,
         'Intention to contract for green energy' = recs_intent,
         'Intention to buy offsets' = offset_intent,
         'Intention to fly less' = fly_intent,
         'Intention to eat less meat' = pbd_intent,
         'Intention to reduce food waste' = foodwaste_intent,
         
         'Beliefs that others drive an EV' = ev_ee,
         'Beliefs that others have solar' = solar_ee,
         'Beliefs that others have green energy' = recs_ee,
         'Beliefs that others bought offsets' = offset_ee,
         'Beliefs that others are flying less' = fly_ee,
         'Beliefs that others eat less meat' = pbd_ee,
         'Beliefs that others reduce food waste' = foodwaste_ee,

         'Beliefs that others should drive an EV' = ev_pnb,
         'Beliefs that others should install solar' = solar_pnb,
         'Beliefs that others should have green energy' = recs_pnb,
         'Beliefs that others should buy offsets' = offset_pnb,
         'Beliefs that others should fly less' = fly_pnb,
         'Beliefs that others should eat less meat' = pbd_pnb,
         'Beliefs that others should reduce food waste' = foodwaste_pnb,

         'Beliefs that others think people should drive an EV' = ev_ne,
         'Beliefs that others think people should install solar' = solar_ne,
         'Beliefs that others think people should have green energy' = recs_ne,
         'Beliefs that others think people should buy offsets' = offset_ne,
         'Beliefs that others think people should fly less' = fly_ne,
         'Beliefs that others think people should eat less meat' = pbd_ne,
         'Beliefs that others think people should reduce food waste' = foodwaste_ne) %>%
  slice(match(x2, Predictor)) #%>% #reorder predictors

sticky_style <- list(position = "sticky", left = 0, background = "#fff", zIndex = 1,
                     borderRight = "1px solid #eee")

tt5 = reactable(tt3,
                height = 500,
  defaultColDef = colDef(
    footer = function(values, name) htmltools::div(name, style = list(fontWeight = 600)),
    style = function(value) {
      if (!is.numeric(value)) return()
      normalized <- (value - min(tt3[-1])) / (max(tt3[-1]) - min(tt3[-1]))
      color <- BuYlRd(normalized)
      list(background = color)
    },
    format = colFormat(digits = 2),
  ),
  style = list(fontSize = "11px"),
  defaultPageSize = 30,
  #defaultSortOrder = 'asc',
  #defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = TRUE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = TRUE,
    # Add theme for the top border
  columns = list(
  `Predictor` =  colDef(
      style = sticky_style,
      headerStyle = sticky_style,
      minWidth = 120),
  `Beliefs that others think people should drive an EV` = colDef(
minWidth = 120),
    `Beliefs that others think people should install solar` = colDef(
minWidth = 120),
    `Beliefs that others think people should have green energy` = colDef(
      minWidth = 120),
    `Beliefs that others think people should eat less meat` = colDef(
minWidth = 120),
    `Beliefs that others think people should reduce food waste` = colDef(
      minWidth = 120)
  ),  
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

tt5

```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, eval = FALSE}
### 

tt4 = reactable(tt3,
                columns = list(
    `EV: PI` = colDef(
      name = "Program interest",
      style = function(value) {
    normalized <- (value - min(tt3$`EV: PI`)) / (max(tt3$`EV: PI`) - min(tt3$`EV: PI`))
    color <- BuYlRd(normalized)
    list(background = color)
  }),
  `EV: Intent` = colDef(
    name = "Intention",
    style = function(value) {
    normalized <- (value - min(tt3$`EV: Intent`)) / (max(tt3$`EV: Intent`) - min(tt3$`EV: Intent`))
    color <- BuYlRd(normalized)
    list(background = color)
  }),
  `EV: Beliefs that others have adopted` = colDef(
    name = "Beliefs that others drive an EV",
    style = function(value) {
    normalized <- (value - min(tt3$`EV: Beliefs that others have adopted`)) / (max(tt3$`EV: Beliefs that others have adopted`) - min(tt3$`EV: Beliefs that others have adopted`))
    color <- BuYlRd(normalized)
    list(background = color)
  }),
  `Solar: PI` = colDef(style = function(value) {
    normalized <- (value - min(tt3$`Solar: PI`)) / (max(tt3$`Solar: PI`) - min(tt3$`Solar: PI`))
    color <- BuYlRd(normalized)
    list(background = color)
  }),
  `Solar: Intent` = colDef(style = function(value) {
    normalized <- (value - min(tt3$`Solar: Intent`)) / (max(tt3$`Solar: Intent`) - min(tt3$`Solar: Intent`))
    color <- BuYlRd(normalized)
    list(background = color)
  }),
  `Solar: Beliefs that others have adopted` = colDef(style = function(value) {
    normalized <- (value - min(tt3$`Solar: Beliefs that others have adopted`)) / (max(tt3$`Solar: Beliefs that others have adopted`) - min(tt3$`Solar: Beliefs that others have adopted`))
    color <- BuYlRd(normalized)
    list(background = color)
  })
  ),
  style = list(fontSize = "11px"),
  defaultPageSize = 30,
  #defaultSortOrder = 'asc',
  #defaultSorted = 'Behavior',
  showSortIcon = FALSE,
  # ALL one page option (no scrolling or page swapping)
    pagination = TRUE,
    # compact for an overall smaller table width wise
    compact = TRUE,
    # borderless - TRUE or FALSE
    borderless = FALSE,
    # Stripes - TRUE or FALSE
    striped = TRUE,
    highlight = TRUE,  
  # fullWidth - either fit to width or not
    fullWidth = TRUE,
    # Add theme for the top border
    theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )
    ),
   columnGroups = list(
    colGroup(name = "Electric Vehicles", columns = c("Program interest", "Intention", "EV: Beliefs that others have adopted", "EV: Beliefs that others should adopt", "EV: Beliefs that others think people should adopt")))) 

tt4
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
library(jtools)
options("jtools-digits" = 6)
reg <- data %>% 
  select(
  wt,
  #Vrid,
  #var13, #RID
  #EV
  #var26, #adoption
  var87, #EE
  var28, #PNB,
  var88, #NE
  var94, #intent
  var96, #program interest
  #Fly
  #var70, #Are you trying to fly less frequently than you used to?
  var69, #EE
  var38, #PNB
  var35, #NE
  var97, #intent
  var98, #program interest
  #Offsets
  #var39, #adoption
  var40, #EE
  var41, #PNB
  var42, #NE
  var99, #intent
  var100, #program interest
  #PBD
  #var71, #Are you trying to eat less meat than you used to?
  #var115, #adoption % of meals
  var72, #EE
  var66, #PNB
  var48, #NE
  var103, #intent
  var104, #program interest
  #RECs
  #var54, #adoption
  var55, #EE
  var56, #PNB
  var57, #NE
  var105, #intent
  var106, #program interest
  #Solar
  #var59, #adoption
  var60, #EE
  var61, #PNB
  var62, #NE
  var107, #intent
  var108, #program interest
  #Food waste
  #var73, #Are you currently trying to reduce the amount of food waste you produce?
  var74, #EE
  var75, #PNB
  var76, #NE
  var109, #intent
  var110, #program interest
  #demographics
  age_group,
  sex,
  ethnicity,
  var20, #politics
  var19, #income
  var17, #education
  ) %>% 
  rename(
  #EV
  #ev_adoption = var26,
  ev_ee = var87,
  ev_pnb = var28,
  ev_ne = var88,
  ev_intent = var94,
  ev_program_interest = var96,
  #Fly
  #fly_adoption = var70, #trying to fly less
  fly_ee = var69, #EE
  fly_pnb = var38, #PNB
  fly_ne = var35, #NE
  fly_intent = var97,
  fly_program_interest = var98,
  #Offset
  #offset_adoption = var39, #adoption
  offset_ee = var40, #EE
  offset_pnb = var41, #PNB
  offset_ne = var42, #NE
  offset_program_interest = var100, #program interest
  offset_intent = var99,
  #PBD
  #pbd_adoption = var71, #trying to
  pbd_ee = var72, #EE
  pbd_pnb = var66, #PNB
  pbd_ne = var48, #NE
  pbd_program_interest = var104, #program interest
  pbd_intent = var103, 
  #RECs
  #recs_adoption = var54, #adoption
  recs_ee = var55, #EE
  recs_pnb = var56, #PNB
  recs_ne = var57, #NE
  recs_program_interest = var106, #program interest
  recs_intent = var105,
  #Solar
  #solar_adoption = var59, #adoption
  solar_ee = var60, #EE
  solar_pnb = var61, #PNB
  solar_ne = var62, #NE
  solar_program_interest = var108, #program interest
  solar_intent = var107,
  #Food waste
  #foodwaste_adoption = var73, #attempt
  foodwaste_ee = var74, #EE
  foodwaste_pnb = var75, #PNB
  foodwaste_ne = var76, #NE
  foodwaste_program_interest = var110, #program interest
  foodwaste_intent = var109,
  #dem
  politics = var20,
  income = var19, 
  education = var17) 

reg <- within(reg, ethnicity <- relevel(ethnicity, ref = "White"))
reg <- within(reg, age_group <- relevel(age_group, ref = "65+"))

reg <- reg %>% 
  mutate(
    income = as.numeric(income),
    income = case_when(income == 10063 ~ 11, TRUE ~ income))

reg$education_category = recode(reg$education, '1' = "No college degree", '2' = "No college degree", '3' = "No college degree", '4' = "College degree", '5' = "College degree", '6' = "Graduate degree")

reg$education_category <- as.factor(reg$education_category)

reg <- within(reg, education_category <- relevel(education_category, ref = "No college degree"))

reg$income_category = recode(reg$income, '1' = "Less than $29,000", '2' = "Less than $29,000", '3' = "$30,000 to $49,000", '4' = "$30,000 to $49,000", '5' = "$50,000 to $69,000", '6' = "$50,000 to $69,000", '7' = "$70,000 to $89,000", '8' = "$70,000 to $89,000", '9' = "$90,000 to $149,000", '10' = "$90,000 to $149,000", '11' = "$150,000 or more")

reg$income_category <- as.factor(reg$income_category)

reg <- within(reg, income_category <- relevel(income_category, ref = "Less than $29,000"))
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
ev_w <- reg %>% 
  lm(scale(ev_intent) ~ scale(ev_ee) + scale(ev_pnb) + scale(ev_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)


ev_d_w <- reg %>% 
  lm(scale(ev_intent) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

ev_d_w <- tidy(ev_d_w) %>% mutate(model = "EV_d_w")

ev_w1 <- tidy(ev_w) %>% 
  filter(!grepl('eth*', term), term != "scale(income)", term != "scale(education)", term != "age_group25-34", term != "age_group35-44", term != "age_group45-54", term != "age_group55-64", term != "age_group65+", term != "sexMale") %>% mutate(model = "EV_w")

ev_w1

ev_w2 <- tidy(ev_w) %>% mutate(model = "EV_w2")

summary(ev_w) 

solar_w <- reg %>% 
  lm(scale(solar_intent) ~ scale(solar_ee) + scale(solar_pnb) + scale(solar_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

solar_d_w <- reg %>%
    lm(scale(solar_intent) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)
  
solar_d_w <- tidy(solar_d_w) %>% mutate(model = "solar_d_w")


solar_w1 <- tidy(solar_w) %>% 
  filter(!grepl('eth*', term), term != "scale(income)", term != "scale(education)", term != "age_group25-34", term != "age_group35-44", term != "age_group45-54", term != "age_group55-64", term != "age_group65+", term != "sexMale") %>% mutate(model = "Solar_w")

solar_w2 <- tidy(solar_w) %>% mutate(model = "Solar_w2")

summary(solar_w)

offset_w <- reg %>% 
  lm(scale(offset_intent) ~ scale(offset_ee) + scale(offset_pnb) + scale(offset_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

offset_d_w <- reg %>% 
  lm(scale(offset_intent) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

offset_d_w <- tidy(offset_d_w) %>% mutate(model = "offset_d_w")


summary(offset_w)

offset_w1 <- tidy(offset_w) %>% 
  filter(!grepl('ethi*', term), term != "scale(income)", term != "scale(education)", term != "age_group25-34", term != "age_group35-44", term != "age_group45-54", term != "age_group55-64", term != "age_group65+", term != "sexMale") %>% mutate(model = "Offset_w")

summary(offset_w1)

offset_w2 <- tidy(offset_w) %>% mutate(model = "offset_w2")


recs_w <- reg %>% 
  lm(scale(recs_intent) ~ scale(recs_ee) + scale(recs_pnb) + scale(recs_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

recs_d_w <- reg %>% 
  lm(scale(recs_intent) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)



recs_d_w <- tidy(recs_d_w) %>% mutate(model = "recs_d_w")


recs_w1 <- tidy(recs_w) %>% 
  filter(!grepl('eth*', term), term != "scale(income)", term != "scale(education)", term != "age_group25-34", term != "age_group35-44", term != "age_group45-54", term != "age_group55-64", term != "age_group65+", term != "sexMale") %>% mutate(model = "RECs_w")

recs_w2 <- tidy(recs_w) %>% mutate(model = "recs_w2")


summary(recs_w)

fly_less_w <- reg %>% 
  lm(scale(fly_intent) ~ scale(fly_ee) + scale(fly_pnb) + scale(fly_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

fly_less_d_w <- reg %>% 
  lm(scale(fly_intent) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

fly_less_d_w <- tidy(fly_less_d_w) %>% mutate(model = "fly_less_d_w")


fly_less_w1 <- tidy(fly_less_w) %>% 
  filter(!grepl('eth*', term), term != "scale(income)", term != "scale(education)", term != "age_group25-34", term != "age_group35-44", term != "age_group45-54", term != "age_group55-64", term != "age_group65+", term != "sexMale") %>% mutate(model = "fly_less_w")

fly_less_w2 <- tidy(fly_less_w) %>% mutate(model = "fly_less_w2")


summary(fly_less_w)

pbd_w <- reg %>% 
  lm(scale(pbd_intent) ~ scale(pbd_ee) + scale(pbd_pnb) + scale(pbd_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

pbd_d_w <- reg %>% 
  lm(scale(pbd_intent) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

pbd_d_w <- tidy(pbd_d_w) %>% mutate(model = "pbd_d_w")


pbd_w_1 <- tidy(pbd_w) %>% 
  filter(!grepl('eth*', term), term != "scale(income)", term != "scale(education)", term != "age_group25-34", term != "age_group35-44", term != "age_group45-54", term != "age_group55-64", term != "age_group65+", term != "sexMale") %>% mutate(model = "pbd_w")

pbd_w2 <- tidy(pbd_w) %>% mutate(model = "pbd_w2")


summary(pbd_w)

food_waste_w <- reg %>% 
  lm(scale(foodwaste_intent) ~ scale(foodwaste_ee) + scale(foodwaste_pnb) + scale(foodwaste_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

food_waste_d_w <- reg %>% 
  lm(scale(foodwaste_intent) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

food_waste_d_w <- tidy(food_waste_d_w) %>% mutate(model = "food_waste_d_w")


food_waste_w1 <- tidy(food_waste_w) %>% 
  filter(!grepl('eth*', term), term != "scale(income)", term != "scale(education)", term != "age_group25-34", term != "age_group35-44", term != "age_group45-54", term != "age_group55-64", term != "age_group65+", term != "sexMale") %>% mutate(model = "food_waste_w")

food_waste_w2 <- tidy(food_waste_w) %>% mutate(model = "food_waste_w2")

summary(food_waste_w)
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
# Program interest
ev_p <- reg %>% 
  lm(scale(ev_program_interest) ~ scale(ev_ee) + scale(ev_pnb) + scale(ev_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

ev_p <- tidy(ev_p) %>% mutate(model = "ev_p")

ev_p_d <- reg %>% 
  lm(scale(ev_program_interest) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

summary(ev_p_d)

ev_p_d <- tidy(ev_p_d) %>% mutate(model = "EV_p_d")

##

solar_p <- reg %>% 
  lm(scale(solar_program_interest) ~ scale(solar_ee) + scale(solar_pnb) + scale(solar_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

solar_p_d <- reg %>%
    lm(scale(solar_program_interest) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)
  
solar_p_d <- tidy(solar_p_d) %>% mutate(model = "solar_p_d")

solar_p <- tidy(solar_p) %>% mutate(model = "solar_p")

##

offset_p <- reg %>% 
  lm(scale(offset_program_interest) ~ scale(offset_ee) + scale(offset_pnb) + scale(offset_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

offset_p_d <- reg %>% 
  lm(scale(offset_program_interest) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

offset_p_d <- tidy(offset_p_d) %>% mutate(model = "offset_p_d")

offset_p <- tidy(offset_p) %>% mutate(model = "offset_p")

##

recs_p <- reg %>% 
  lm(scale(recs_program_interest) ~ scale(recs_ee) + scale(recs_pnb) + scale(recs_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

recs_p_d <- reg %>% 
  lm(scale(recs_program_interest) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

recs_p_d <- tidy(recs_p_d) %>% mutate(model = "recs_p_d")

recs_p <- tidy(recs_p) %>% mutate(model = "recs_p")

##

fly_less_p <- reg %>% 
  lm(scale(fly_program_interest) ~ scale(fly_ee) + scale(fly_pnb) + scale(fly_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

fly_less_p_d <- reg %>% 
  lm(scale(fly_program_interest) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

fly_less_p_d <- tidy(fly_less_p_d) %>% mutate(model = "fly_less_p_d")


fly_less_p <- tidy(fly_less_p) %>% mutate(model = "fly_less_p")

##

pbd_p <- reg %>% 
  lm(scale(pbd_program_interest) ~ scale(pbd_ee) + scale(pbd_pnb) + scale(pbd_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

pbd_p_d <- reg %>% 
  lm(scale(pbd_program_interest) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

pbd_p_d <- tidy(pbd_p_d) %>% mutate(model = "pbd_p_d")

pbd_p <- tidy(pbd_p) %>% mutate(model = "pbd_p")

##

food_waste_p <- reg %>% 
  lm(scale(foodwaste_program_interest) ~ scale(foodwaste_ee) + scale(foodwaste_pnb) + scale(foodwaste_ne) + scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

food_waste_p_d <- reg %>% 
  lm(scale(foodwaste_program_interest) ~ scale(politics) + income_category + education_category + age_group + sex + ethnicity, data =.)

food_waste_p_d <- tidy(food_waste_p_d) %>% mutate(model = "food_waste_p_d")

food_waste_p <- tidy(food_waste_p) %>% mutate(model = "food_waste_p")
```

```{r, include = FALSE, eval = FALSE}
ev_p_d1 <- reg %>% 
  lm(scale(ev_program_interest) ~ income_category, data =.)
summary(ev_p_d1)

ev_p_d2 <- reg %>% 
  lm(scale(ev_program_interest) ~ income_category + education_category, data =.)
summary(ev_p_d2)

ev_p_d3 <- reg %>% 
  lm(scale(ev_program_interest) ~ income_category + ethnicity, data =.)
summary(ev_p_d3)

ev_p_d4 <- reg %>% 
  lm(scale(ev_program_interest) ~ age_group, data =.)
summary(ev_p_d4)

+ education_category + age_group + sex + ethnicity

###

solar_p_d1 <- reg %>% 
  lm(scale(solar_program_interest) ~ income_category + education_category + ethnicity + sex + age_group, data =.)
summary(solar_p_d1)
summ(solar_p_d1, vifs = TRUE)
#summ(ev_p_d2, vifs = TRUE)

solar_p_d2 <- reg %>% 
  lm(scale(solar_program_interest) ~ education_category + income_category + age_group, data =.)
summary(solar_p_d2)

ev_p_d3 <- reg %>% 
  lm(scale(ev_program_interest) ~ income_category + ethnicity, data =.)
summary(ev_p_d3)

ev_p_d4 <- reg %>% 
  lm(scale(ev_program_interest) ~ age_group, data =.)
summary(ev_p_d4)

###


carbon_p_d <- reg %>% 
  lm(scale(offset_program_interest) ~ income_category + education_category, data =.)
summary(carbon_p_d)


## fly less

fly_p_d <- reg %>% 
  lm(scale(fly_program_interest) ~ education_category + income_category + sex, data =.)
summary(fly_p_d)

## reduce food waste

food_waste_p_d <- reg %>% 
  lm(scale(foodwaste_program_interest) ~ sex + ethnicity, data =.)
summary(food_waste_p_d)


### pbd

pbd_program <- reg %>% 
  lm(scale(pbd_program_interest) ~ ethnicity, data =.)
summary(pbd_program)


## correlations between demographics

corr_table_3 <- corr_table_2 %>% 
  select(education, income, sex_Female, sex_Male, ethnicity_Asian:age_group_65.)

res.cor2 <- correlate(corr_table_3)

res.cor2$term[res.cor2$term == "income"] <- "Household income"
res.cor2$term[res.cor2$term == "age_group_18.24"] <- "Age: 18-24"
res.cor2$term[res.cor2$term == "age_group_25.34"] <- "Age: 25-34"
res.cor2$term[res.cor2$term == "age_group_35.44"] <- "Age: 35-44"
res.cor2$term[res.cor2$term == "age_group_45.54"] <- "Age: 45-54"
res.cor2$term[res.cor2$term == "age_group_55.64"] <- "Age: 55-64"
res.cor2$term[res.cor2$term == "age_group_65."] <- "Age: 65+"
res.cor2$term[res.cor2$term == "sex_Female"] <- "Female"
res.cor2$term[res.cor2$term == "sex_Male"] <- "Male"

res.cor2$term[res.cor2$term == "ethnicity_White"] <- "Ethnicity: White"
res.cor2$term[res.cor2$term == "ethnicity_Black"] <- "Ethnicity: Black"
res.cor2$term[res.cor2$term == "ethnicity_Asian"] <- "Ethnicity: Asian"
res.cor2$term[res.cor2$term == "ethnicity_Other"] <- "Ethnicity: Other"

res.cor2$term[res.cor2$term == "education"] <- "Education level"
#res.cor2$term[res.cor2$term == "politics"] <- "Political orientation: Conservative"
```

```{r, eval = FALSE, include = FALSE}
reg1 <- reg %>% 
  select(fly_program_interest, sex, age_group, income_category, politics, education_category, ethnicity)

# Create variables 
x_vars = model.matrix(fly_program_interest~., reg1)[ ,-1] # remove DV, leave only predictors
y_var = reg1$fly_program_interest
lam = 10^seq(2,-2, by = -.1)

# Create a test/train sample split (equal split)
set.seed(1)
train = sample(1:nrow(x_vars),nrow(x_vars)/(2))
x_test = reg1[-train, ]
y_test = x_test$fly_program_interest

library(glmnet)

# Identify the best lambda
cv_output = cv.glmnet(x_vars[train, ], y_var[train],
                      alpha= 1, lambda = lam)
best_lam = cv_output$lambda.min
#best_lam


# Use the best lambda to train the LASSO model
lasso = glmnet(x_vars[train, ], y_var[train], 
               alpha=1, lambda = best_lam)

coef(lasso)
```

#### Plots of standardized regression coefficients from linear models regressing intention to perform each behavior/program interest on each of the listed covariates

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, fig.width = 9, fig.height = 5, include = FALSE}
# Use tibble dfs
models <- rbind(ev_w1, offset_w1, recs_w1, solar_w1, pbd_w_1, food_waste_w1, fly_less_w1)

# Create list of brackets (label, topmost included predictor, bottommost included predictor)
bracket <- list(c("Beliefs about ...", "Others' behavior", "What others' think \nshould be done"))

p <- {dwplot(models, 
        vline = geom_vline(xintercept = 0, colour = "grey60", linetype = 2), 
        # Customize the of appearance of the dots and whiskers
        dot_args = list(aes(shape = model)),
        whisker_args = list(aes(linetype = model))) %>%
    # Put models on one graph by assigning them to the same names
    relabel_predictors(c("scale(ev_ee)" = "Others' behavior",                  
                         "scale(ev_pnb)" = "What should be done", 
                         "scale(ev_ne)" = "What others' think \nshould be done", 
                         "scale(offset_ee)" = "Others' behavior",            
                         "scale(offset_pnb)" = "What should be done", 
                         "scale(offset_ne)" = "What others' think \nshould be done",
                         "scale(recs_ee)" = "Others' behavior",                 
                         "scale(recs_pnb)" = "What should be done", 
                         "scale(recs_ne)" = "What others' think \nshould be done",
                         "scale(solar_ee)" = "Others' behavior",                       
                         "scale(solar_pnb)" = "What should be done", 
                         "scale(solar_ne)" = "What others' think \nshould be done",
                         "scale(foodwaste_ee)" = "Others' behavior",            
                         "scale(foodwaste_pnb)" = "What should be done", 
                         "scale(foodwaste_ne)" = "What others' think \nshould be done",
                         "scale(pbd_ee)" = "Others' behavior",                 
                         "scale(pbd_pnb)" = "What should be done", 
                         "scale(pbd_ne)" = "What others' think \nshould be done",
                         "scale(fly_ee)" = "Others' behavior",                       
                         "scale(fly_pnb)" = "What should be done", 
                         "scale(fly_ne)" = "What others' think \nshould be done",
                         "scale(politics)" = "Political orientation")) +
    xlab("Standardized coefficient estimate") + ylab("") + 
    theme_bw() +
    # Add colorblind-friendly palette & legend values = c("#000000","#D55E00","#CC79A7","#0072B2")
    scale_colour_manual(values = c("#000000","#000000","#000000","#000000", "red", "red", "red"), 
                     name = "", 
                     labels = c("Purchase an electric vehicle", "Purchase carbon offsets", "Contract for green energy", "Install solar panels", "Reduce food waste", "Eat less meat", "Fly less"),
                     guide = guide_legend(reverse = TRUE)) +
    # Add customized glyphs
    scale_shape_manual(values = c(16, 4, 15, 3, 8, 6, 0),
                      name = "",
                      labels = c("Purchase an electric vehicle", "Purchase carbon offsets", "Contract for green energy", "Install solar panels", "Reduce food waste", "Eat less meat", "Fly less"),
                      guide = guide_legend(reverse = TRUE)) +
   theme(#axis.title = element_text(size = 16),
         #plot.margin = unit(c(0,0,0,0),"cm"),
         #text = element_text(family="TT Times New Roman"),
         legend.justification = c(0, 0), 
         # Legend bottom right position 
         legend.position = c(0.66, 0.000001),
         # Legend text size
         legend.text = element_text(size = 8, colour = "black"),
         #legend.title.align = .5,
         # Transparent legend text and glyph background
         legend.background = element_rect(fill= "transparent"),
         legend.key = element_rect(colour = "transparent", fill = "transparent"),
         # Axis
         axis.line = element_line(color = "grey"),
         axis.ticks = element_line(color = "grey"),
         axis.text.x  = element_text(hjust = 1, size = 11, color = "black"),
         axis.text.y = element_text(size = 11, color = "black"),
         axis.title.x = element_text(color = "black", size = 11),
         axis.title.y = element_text(color = "black", size = 11),
         # Panel
         #panel.grid.major = element_line(size = 0.25, linetype = 'solid', color = "grey"), 
         #panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey"),
         panel.background = element_blank(),
         panel.border = element_rect(color = "grey", fill = NA, size = 0.5))} %>% add_brackets(bracket, face = "bold.italic")

grid.draw(p)
ggsave("Dot-whisker.tiff", units = "in", width = 9, height = 5, device='tiff', dpi = 300)
```

##### Intention to adopt: coefficients from linear models that included demographic and psychological variables

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, fig.width = 8, fig.height = 14}
# Use tibble dfs
models <- rbind(ev_w2, offset_w2, recs_w2, solar_w2, food_waste_w2, pbd_w2, fly_less_w2)

# Create list of brackets (label, topmost included predictor, bottommost included predictor)
#bracket <- list(c("Beliefs about ...", "Others' behavior", "What others' think \nshould be done"))

p <- {dwplot(models, 
        vline = geom_vline(xintercept = 0, colour = "grey60", linetype = 2), 
        # Customize the of appearance of the dots and whiskers
        dot_args = list(aes(shape = model)),
        whisker_args = list(aes(linetype = model))) %>%
    # Put models on one graph by assigning them to the same names
    relabel_predictors(c("scale(ev_ee)" = "Beliefs about \nothers' behavior",                  
                         "scale(ev_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(ev_ne)" = "Beliefs about \nwhat others' think \nshould be done", 
                         "scale(offset_ee)" = "Beliefs about \nothers' behavior",            
                         "scale(offset_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(offset_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(recs_ee)" = "Beliefs about \nothers' behavior",                 
                         "scale(recs_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(recs_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(solar_ee)" = "Beliefs about \nothers' behavior",                       
                         "scale(solar_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(solar_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(foodwaste_ee)" = "Beliefs about \nothers' behavior",            
                         "scale(foodwaste_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(foodwaste_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(pbd_ee)" = "Beliefs about \nothers' behavior",                 
                         "scale(pbd_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(pbd_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(fly_ee)" = "Beliefs about \nothers' behavior",                       
                         "scale(fly_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(fly_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "sexMale" = "Gender: Male",
                         "age_group18-24" = "Age: 18-24",
                         "age_group25-34" = "Age: 25-34",
                         "age_group35-44" = "Age: 35-44",
                         "age_group45-54" = "Age: 45-54",
                         "age_group55-64" = "Age: 55-64",
                         "ethnicityAsian" = "Ethnicity: Asian",
                         "ethnicityBlack" = "Ethnicity: Black or \nAfrican American",
                         "ethnicityOther" = "Ethnicity: Other",
                         "income_category$30,000 to $49,000" = "Household income: \n$30,000 to $49,000",
                         "income_category$50,000 to $69,000" = "Household income: \n$50,000 to $69,000",
                         "income_category$70,000 to $89,000" = "Household income: \n$70,000 to $89,000",
                         "income_category$90,000 to $149,000" = "Household income: \n$90,000 to $149,000",
                         "income_category$150,000 or more" = "Household income: \n$150,000 or more",
                         "education_categoryCollege degree" = "Education level: \nCollege degree",
                         "education_categoryGraduate degree" = "Education level: \nGraduate degree",
                         "scale(politics)" = "Political orientation")) +
    xlab("Standardized coefficient estimate") + ylab("") + 
    theme_bw() +
    # Add colorblind-friendly palette & legend values = c("#000000","#D55E00","#CC79A7","#0072B2")
    scale_colour_manual(values = c("#000000","#000000","#000000","#000000", "red", "red", "red"), 
                     name = "", 
                     labels = c("Purchase an EV", "Purchase offsets", "Contract for green \nenergy", "Install solar", "Reduce food waste", "Eat less meat", "Fly less"),
                     guide = guide_legend(reverse = TRUE)) +
    # Add customized glyphs
    scale_shape_manual(values = c(16, 4, 15, 3, 8, 6, 0),
                      name = "",
                      labels = c("Purchase an EV", "Purchase offsets", "Contract for green \nenergy", "Install solar", "Reduce food waste", "Eat less meat", "Fly less"),
                      guide = guide_legend(reverse = TRUE)) +
   theme(#axis.title = element_text(size = 16),
         #plot.margin = unit(c(0,0,0,0),"cm"),
         #text = element_text(family="TT Times New Roman"),
         legend.justification = c(0, 0), 
         # Legend bottom right position 
         legend.position = c(0.77, 0.000001),
         # Legend text size
         legend.text = element_text(size = 8, colour = "black"),
         #legend.title.align = .5,
         # Transparent legend text and glyph background
         legend.background = element_rect(fill= "transparent"),
         legend.key = element_rect(colour = "transparent", fill = "transparent"),
         # Axis
         axis.line = element_line(color = "grey"),
         axis.ticks = element_line(color = "grey"),
         axis.text.x  = element_text(hjust = 1, size = 11, color = "black"),
         axis.text.y = element_text(size = 11, color = "black"),
         axis.title.x = element_text(color = "black", size = 11),
         axis.title.y = element_text(color = "black", size = 11),
         # Panel
         #panel.grid.major = element_line(size = 0.25, linetype = 'solid', color = "grey"), 
         #panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey"),
         panel.background = element_blank(),
         panel.border = element_rect(color = "grey", fill = NA, size = 0.5))} #%>% add_brackets(bracket, face = "bold.italic")

grid.draw(p)
#ggsave("Dot-whisker.tiff", units = "in", width = 11, height = 6, device='tiff', dpi = 300)
```

##### Intention to adopt: coefficients from linear models that included demographic variables and political orientation only

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, fig.width = 8, fig.height = 12}
# Use tibble dfs
models <- rbind(ev_d_w, offset_d_w, recs_d_w, solar_d_w, food_waste_d_w, pbd_d_w, fly_less_d_w)

# Create list of brackets (label, topmost included predictor, bottommost included predictor)
#bracket <- list(c("Beliefs about ...", "Others' behavior", "What others' think \nshould be done"))

p <- {dwplot(models, 
        vline = geom_vline(xintercept = 0, colour = "grey60", linetype = 2), 
        # Customize the of appearance of the dots and whiskers
        dot_args = list(aes(shape = model)),
        whisker_args = list(aes(linetype = model))) %>%
    # Put models on one graph by assigning them to the same names
    relabel_predictors(c("sexMale" = "Gender: Male",
                         "age_group18-24" = "Age: 18-24",
                         "age_group25-34" = "Age: 25-34",
                         "age_group35-44" = "Age: 35-44",
                         "age_group45-54" = "Age: 45-54",
                         "age_group55-64" = "Age: 55-64",
                         "ethnicityAsian" = "Ethnicity: Asian",
                         "ethnicityBlack" = "Ethnicity: Black or \nAfrican American",
                         "ethnicityOther" = "Ethnicity: Other",
                         "income_category$30,000 to $49,000" = "Household income: \n$30,000 to $49,000",
                         "income_category$50,000 to $69,000" = "Household income: \n$50,000 to $69,000",
                         "income_category$70,000 to $89,000" = "Household income: \n$70,000 to $89,000",
                         "income_category$90,000 to $149,000" = "Household income: \n$90,000 to $149,000",
                         "income_category$150,000 or more" = "Household income: \n$150,000 or more",
                         "education_categoryCollege degree" = "Education level: \nCollege degree",
                         "education_categoryGraduate degree" = "Education level: \nGraduate degree",
                         "scale(politics)" = "Political orientation")) +
    xlab("Standardized coefficient estimate") + ylab("") + 
    theme_bw() +
    # Add colorblind-friendly palette & legend values = c("#000000","#D55E00","#CC79A7","#0072B2")
    scale_colour_manual(values = c("#000000","#000000","#000000","#000000", "red", "red", "red"), 
                     name = "", 
                     labels = c("Purchase an EV", "Purchase offsets", "Contract for green energy", "Install solar", "Reduce food waste", "Eat less meat", "Fly less"),
                     guide = guide_legend(reverse = TRUE)) +
    # Add customized glyphs
    scale_shape_manual(values = c(16, 4, 15, 3, 8, 6, 0),
                      name = "",
                      labels = c("Purchase an EV", "Purchase offsets", "Contract for green energy", "Install solar", "Reduce food waste", "Eat less meat", "Fly less"),
                      guide = guide_legend(reverse = TRUE)) +
   theme(#axis.title = element_text(size = 16),
         #plot.margin = unit(c(0,0,0,0),"cm"),
         #text = element_text(family="TT Times New Roman"),
         legend.justification = c(0, 0), 
         # Legend bottom right position 
         legend.position = c(0.71, 0.000001),
         # Legend text size
         legend.text = element_text(size = 8, colour = "black"),
         #legend.title.align = .5,
         # Transparent legend text and glyph background
         legend.background = element_rect(fill= "transparent"),
         legend.key = element_rect(colour = "transparent", fill = "transparent"),
         # Axis
         axis.line = element_line(color = "grey"),
         axis.ticks = element_line(color = "grey"),
         axis.text.x  = element_text(hjust = 1, size = 11, color = "black"),
         axis.text.y = element_text(size = 11, color = "black"),
         axis.title.x = element_text(color = "black", size = 11),
         axis.title.y = element_text(color = "black", size = 11),
         # Panel
         #panel.grid.major = element_line(size = 0.25, linetype = 'solid', color = "grey"), 
         #panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey"),
         panel.background = element_blank(),
         panel.border = element_rect(color = "grey", fill = NA, size = 0.5))}

grid.draw(p)
#ggsave("Dot-whisker.tiff", units = "in", width = 11, height = 6, device='tiff', dpi = 300)
```

##### Program interest: coefficients from linear models that included demographic and psychological variables

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, fig.width = 8, fig.height = 14}
# Use tibble dfs
models <- rbind(ev_p, offset_p, recs_p, solar_p, food_waste_p, pbd_p, fly_less_p)

# Create list of brackets (label, topmost included predictor, bottommost included predictor)
#bracket <- list(c("Beliefs about ...", "Others' behavior", "What others' think \nshould be done"))

p <- {dwplot(models, 
        vline = geom_vline(xintercept = 0, colour = "grey60", linetype = 2), 
        # Customize the of appearance of the dots and whiskers
        dot_args = list(aes(shape = model)),
        whisker_args = list(aes(linetype = model))) %>%
    # Put models on one graph by assigning them to the same names
    relabel_predictors(c("scale(ev_ee)" = "Beliefs about \nothers' behavior",                  
                         "scale(ev_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(ev_ne)" = "Beliefs about \nwhat others' think \nshould be done", 
                         "scale(offset_ee)" = "Beliefs about \nothers' behavior",            
                         "scale(offset_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(offset_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(recs_ee)" = "Beliefs about \nothers' behavior",                 
                         "scale(recs_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(recs_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(solar_ee)" = "Beliefs about \nothers' behavior",                       
                         "scale(solar_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(solar_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(foodwaste_ee)" = "Beliefs about \nothers' behavior",            
                         "scale(foodwaste_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(foodwaste_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(pbd_ee)" = "Beliefs about \nothers' behavior",                 
                         "scale(pbd_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(pbd_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(fly_ee)" = "Beliefs about \nothers' behavior",                       
                         "scale(fly_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(fly_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "sexMale" = "Gender: Male",
                         "age_group18-24" = "Age: 18-24",
                         "age_group25-34" = "Age: 25-34",
                         "age_group35-44" = "Age: 35-44",
                         "age_group45-54" = "Age: 45-54",
                         "age_group55-64" = "Age: 55-64",
                         "ethnicityAsian" = "Ethnicity: Asian",
                         "ethnicityBlack" = "Ethnicity: Black or \nAfrican American",
                         "ethnicityOther" = "Ethnicity: Other",
                         "income_category$30,000 to $49,000" = "Household income: \n$30,000 to $49,000",
                         "income_category$50,000 to $69,000" = "Household income: \n$50,000 to $69,000",
                         "income_category$70,000 to $89,000" = "Household income: \n$70,000 to $89,000",
                         "income_category$90,000 to $149,000" = "Household income: \n$90,000 to $149,000",
                         "income_category$150,000 or more" = "Household income: \n$150,000 or more",
                         "education_categoryCollege degree" = "Education level: \nCollege degree",
                         "education_categoryGraduate degree" = "Education level: \nGraduate degree",
                         "scale(politics)" = "Political orientation")) +
    xlab("Standardized coefficient estimate") + ylab("") + 
    theme_bw() +
    # Add colorblind-friendly palette & legend values = c("#000000","#D55E00","#CC79A7","#0072B2")
    scale_colour_manual(values = c("#000000","#000000","#000000","#000000", "red", "red", "red"), 
                     name = "", 
                     labels = c("Program interest: EV", "Program interest: offsets", "Program interest: green energy", "Program interest: solar", "Program interest: reduce food waste", "Program interest: PBD", "Program interest: Fly less"),
                     guide = guide_legend(reverse = TRUE)) +
    # Add customized glyphs
    scale_shape_manual(values = c(16, 4, 15, 3, 8, 6, 0),
                      name = "",
                      labels = c("Program interest: EV", "Program interest: offsets", "Program interest: green energy", "Program interest: solar", "Program interest: reduce food waste", "Program interest: PBD", "Program interest: Fly less"),
                      guide = guide_legend(reverse = TRUE)) +
   theme(#axis.title = element_text(size = 16),
         #plot.margin = unit(c(0,0,0,0),"cm"),
         #text = element_text(family="TT Times New Roman"),
         legend.justification = c(0, 0), 
         # Legend bottom right position 
         legend.position = c(0.01, 0.000001),
         # Legend text size
         legend.text = element_text(size = 8, colour = "black"),
         #legend.title.align = .5,
         # Transparent legend text and glyph background
         legend.background = element_rect(fill= "transparent"),
         legend.key = element_rect(colour = "transparent", fill = "transparent"),
         # Axis
         axis.line = element_line(color = "grey"),
         axis.ticks = element_line(color = "grey"),
         axis.text.x  = element_text(hjust = 1, size = 11, color = "black"),
         axis.text.y = element_text(size = 11, color = "black"),
         axis.title.x = element_text(color = "black", size = 11),
         axis.title.y = element_text(color = "black", size = 11),
         # Panel
         #panel.grid.major = element_line(size = 0.25, linetype = 'solid', color = "grey"), 
         #panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey"),
         panel.background = element_blank(),
         panel.border = element_rect(color = "grey", fill = NA, size = 0.5))} #%>% add_brackets(bracket, face = "bold.italic")

grid.draw(p)
#ggsave("Dot-whisker.tiff", units = "in", width = 11, height = 6, device='tiff', dpi = 300)
```

##### Program interest: coefficients from linear models that included demographic variables and political orientation only

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, fig.width = 8, fig.height = 14}
# Use tibble dfs
models <- rbind(ev_p_d, offset_p_d, recs_p_d, solar_p_d, food_waste_p_d, pbd_p_d, fly_less_p_d)

# Create list of brackets (label, topmost included predictor, bottommost included predictor)
#bracket <- list(c("Beliefs about ...", "Others' behavior", "What others' think \nshould be done"))

p <- {dwplot(models, 
        vline = geom_vline(xintercept = 0, colour = "grey60", linetype = 2), 
        # Customize the of appearance of the dots and whiskers
        dot_args = list(aes(shape = model)),
        whisker_args = list(aes(linetype = model))) %>%
    # Put models on one graph by assigning them to the same names
    relabel_predictors(c("scale(ev_ee)" = "Beliefs about \nothers' behavior",                  
                         "scale(ev_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(ev_ne)" = "Beliefs about \nwhat others' think \nshould be done", 
                         "scale(offset_ee)" = "Beliefs about \nothers' behavior",            
                         "scale(offset_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(offset_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(recs_ee)" = "Beliefs about \nothers' behavior",                 
                         "scale(recs_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(recs_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(solar_ee)" = "Beliefs about \nothers' behavior",                       
                         "scale(solar_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(solar_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(foodwaste_ee)" = "Beliefs about \nothers' behavior",            
                         "scale(foodwaste_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(foodwaste_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(pbd_ee)" = "Beliefs about \nothers' behavior",                 
                         "scale(pbd_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(pbd_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "scale(fly_ee)" = "Beliefs about \nothers' behavior",                       
                         "scale(fly_pnb)" = "Beliefs about \nwhat should be done", 
                         "scale(fly_ne)" = "Beliefs about \nwhat others' think \nshould be done",
                         "sexMale" = "Gender: Male",
                         "age_group18-24" = "Age: 18-24",
                         "age_group25-34" = "Age: 25-34",
                         "age_group35-44" = "Age: 35-44",
                         "age_group45-54" = "Age: 45-54",
                         "age_group55-64" = "Age: 55-64",
                         "ethnicityAsian" = "Ethnicity: Asian",
                         "ethnicityBlack" = "Ethnicity: Black or \nAfrican American",
                         "ethnicityOther" = "Ethnicity: Other",
                         "income_category$30,000 to $49,000" = "Household income: \n$30,000 to $49,000",
                         "income_category$50,000 to $69,000" = "Household income: \n$50,000 to $69,000",
                         "income_category$70,000 to $89,000" = "Household income: \n$70,000 to $89,000",
                         "income_category$90,000 to $149,000" = "Household income: \n$90,000 to $149,000",
                         "income_category$150,000 or more" = "Household income: \n$150,000 or more",
                         "education_categoryCollege degree" = "Education level: \nCollege degree",
                         "education_categoryGraduate degree" = "Education level: \nGraduate degree",
                         "scale(politics)" = "Political orientation")) +
    xlab("Standardized coefficient estimate") + ylab("") + 
    theme_bw() +
    # Add colorblind-friendly palette & legend values = c("#000000","#D55E00","#CC79A7","#0072B2")
    scale_colour_manual(values = c("#000000","#000000","#000000","#000000", "red", "red", "red"), 
                     name = "", 
                     labels = c("Program interest: EV", "Program interest: offsets", "Program interest: green energy", "Program interest: solar", "Program interest: reduce food waste", "Program interest: PBD", "Program interest: Fly less"),
                     guide = guide_legend(reverse = TRUE)) +
    # Add customized glyphs
    scale_shape_manual(values = c(16, 4, 15, 3, 8, 6, 0),
                      name = "",
                      labels = c("Program interest: EV", "Program interest: offsets", "Program interest: green energy", "Program interest: solar", "Program interest: reduce food waste", "Program interest: PBD", "Program interest: Fly less"),
                      guide = guide_legend(reverse = TRUE)) +
   theme(#axis.title = element_text(size = 16),
         #plot.margin = unit(c(0,0,0,0),"cm"),
         #text = element_text(family="TT Times New Roman"),
         legend.justification = c(0, 0), 
         # Legend bottom right position 
         legend.position = c(0.01, 0.000001),
         # Legend text size
         legend.text = element_text(size = 8, colour = "black"),
         #legend.title.align = .5,
         # Transparent legend text and glyph background
         legend.background = element_rect(fill= "transparent"),
         legend.key = element_rect(colour = "transparent", fill = "transparent"),
         # Axis
         axis.line = element_line(color = "grey"),
         axis.ticks = element_line(color = "grey"),
         axis.text.x  = element_text(hjust = 1, size = 11, color = "black"),
         axis.text.y = element_text(size = 11, color = "black"),
         axis.title.x = element_text(color = "black", size = 11),
         axis.title.y = element_text(color = "black", size = 11),
         # Panel
         #panel.grid.major = element_line(size = 0.25, linetype = 'solid', color = "grey"), 
         #panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey"),
         panel.background = element_blank(),
         panel.border = element_rect(color = "grey", fill = NA, size = 0.5))} #%>% add_brackets(bracket, face = "bold.italic")

grid.draw(p)
#ggsave("Dot-whisker.tiff", units = "in", width = 11, height = 6, device='tiff', dpi = 300)
```

#### People underestimate how many people think they should take actions

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
pnb_ne_plot <- data %>% 
  select(
  #wt,
  #Vrid,
  #var13, #RID
  #EV
  #var26, #adoption
  #var87, #EE
  var28, #PNB,
  var88, #NE
  #var94, #intent
  #var96, #program interest
  #Fly
  #var70, #Are you trying to fly less frequently than you used to?
  #var69, #EE
  var38, #PNB
  var35, #NE
  #var97, #intent
  #var98, #program interest
  #Offsets
  #var39, #adoption
  #var40, #EE
  var41, #PNB
  var42, #NE
  #var99, #intent
  #var100, #program interest
  #PBD
  #var71, #Are you trying to eat less meat than you used to?
  #var115, #adoption % of meals
  #var72, #EE
  var66, #PNB
  var48, #NE
  #var103, #intent
  #var104, #program interest
  #RECs
  #var54, #adoption
  #var55, #EE
  var56, #PNB
  var57, #NE
  #var105, #intent
  #var106, #program interest
  #Solar
  #var59, #adoption
  #var60, #EE
  var61, #PNB
  var62, #NE
  #var107, #intent
  #var108, #program interest
  #Food waste
  #var73, #Are you currently trying to reduce the amount of food waste you produce?
  #var74, #EE
  var75, #PNB
  var76, #NE
  #var109, #intent
  #var110, #program interest
  #demographics
  #age_group,
  #sex,
  #ethnicity,
  #var20, #politics
  #var19, #income
  #var17, #education
  ) %>% 
  rename(
  #EV
  #ev_adoption = var26,
  #ev_ee = var87,
  ev_pnb = var28,
  ev_ne = var88,
  #ev_intent = var94,
  #ev_program_interest = var96,
  #Fly
  #fly_adoption = var70, #trying to fly less
  #fly_ee = var69, #EE
  fly_pnb = var38, #PNB
  fly_ne = var35, #NE
  #fly_intent = var97,
  #fly_program_interest = var98,
  #Offset
  #offset_adoption = var39, #adoption
  #offset_ee = var40, #EE
  offset_pnb = var41, #PNB
  offset_ne = var42, #NE
  #offset_program_interest = var100, #program interest
  #offset_intent = var99,
  #PBD
  #pbd_adoption = var71, #trying to
  #pbd_ee = var72, #EE
  pbd_pnb = var66, #PNB
  pbd_ne = var48, #NE
  #pbd_program_interest = var104, #program interest
  #pbd_intent = var103, 
  #RECs
  #recs_adoption = var54, #adoption
  #recs_ee = var55, #EE
  recs_pnb = var56, #PNB
  recs_ne = var57, #NE
  #recs_program_interest = var106, #program interest
  #recs_intent = var105,
  #Solar
  #solar_adoption = var59, #adoption
  #solar_ee = var60, #EE
  solar_pnb = var61, #PNB
  solar_ne = var62, #NE
  #solar_program_interest = var108, #program interest
  #solar_intent = var107,
  #Food waste
  #foodwaste_adoption = var73, #attempt
  #foodwaste_ee = var74, #EE
  foodwaste_pnb = var75, #PNB
  foodwaste_ne = var76, #NE
  #foodwaste_program_interest = var110, #program interest
  #foodwaste_intent = var109
  )

avgNE = pnb_ne_plot %>%
  select(ev_ne, offset_ne, pbd_ne, fly_ne, solar_ne, recs_ne, foodwaste_ne) %>%
  summarise_all(mean) %>%
  gather() %>%
  mutate(
    value = value*10,
    key = recode(key, ev_ne = "Next car \nis EV", offset_ne = "Buy offsets", pbd_ne = "Eat less \nmeat", fly_ne = "Fly less", recs_ne = "Buy green \nenergy", solar_ne = "Install solar", foodwaste_ne = "Reduce food \nwaste"))


avgPNB = pnb_ne_plot %>%
  select(ev_pnb, offset_pnb, pbd_pnb, fly_pnb, solar_pnb, recs_pnb, foodwaste_pnb)%>%
  summarise_all(mean)%>%
  gather()%>%
  mutate(
    value = value*100,
    key = recode(key, ev_pnb = "Next car \nis EV", offset_pnb = "Buy offsets", pbd_pnb = "Eat less \nmeat", fly_pnb = "Fly less", recs_pnb = "Buy green \nenergy", solar_pnb = "Install solar", foodwaste_pnb = "Reduce food \nwaste"))

normativediff = full_join(avgPNB, avgNE, by = "key") %>%
  arrange(value.x) %>%
  rename("Perceived proportion\nthinking people should" = value.y, "Actual proportion\nthinking people should" = value.x) %>% 
  mutate(
    
  )

normativediff %>%
gather("belief", "Prevalence", -key)%>%
  ggplot(aes(x = reorder(key, -Prevalence),y = Prevalence, fill = belief))+
  geom_col(position = "dodge") +
  scale_fill_manual(values = c("#005BBB", "grey"),
                    name = "Beliefs", labels = c("Actual % thinking people should \nadopt the behaviors", "Perceived % thinking people \nshould adopt the behaviors")) +
theme(axis.line = element_line(color="white"),
        axis.ticks = element_line(color="white"),
        panel.border = element_blank(),
        axis.title.y = element_text(color = "black", size = 10.5),
        axis.title.x = element_blank(),
        axis.text.x = element_text(colour="black", size = 10.5),
        axis.text.y = element_text(colour="black", size = 10.5),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        legend.position = "bottom") +
  scale_y_continuous(labels = function(x) paste0(x,"%"))
```


### Appendix

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
# Build a master table of differences

diff_table <- data %>% 
      select(
  age_group,
  sex,
  ethnicity,
  var17,
  var19,
  wt,
  #EV
  var26, #adoption
  var87, #EE
  var28, #PNB,
  var88, #NE
  var94, #intent
  var96, #program interest
  #Fly
  var70, #Are you trying to fly less frequently than you used to?
  var69, #EE
  var38, #PNB
  var35, #NE
  var97, #intent
  var98, #program interest
  #Offsets
  var39, #adoption
  var40, #EE
  var41, #PNB
  var42, #NE
  var99, #intent
  var100, #program interest
  #PBD
  var71, #Are you trying to eat less meat than you used to?
  var115, #adoption % of meals
  var72, #EE
  var66, #PNB
  var48, #NE
  var103, #intent
  var104, #program interest
  #RECs
  var54, #adoption
  var55, #EE
  var56, #PNB
  var57, #NE
  var105, #intent
  var106, #program interest
  #Solar
  var59, #adoption
  var60, #EE
  var61, #PNB
  var62, #NE
  var107, #intent
  var108, #program interest
  #Food waste
  var73, #Are you currently trying to reduce the amount of food waste you produce?
  var74, #EE
  var75, #PNB
  var76, #NE
  var109, #intent
  var110 #program interest
  ) %>% 
  rename(
  #EV
  ev_adoption = var26,
  ev_ee = var87,
  ev_pnb = var28,
  ev_ne = var88,
  ev_intent = var94,
  ev_program_interest = var96,
  #Fly
  fly_adoption = var70, #trying to fly less
  fly_ee = var69, #EE
  fly_pnb = var38, #PNB
  fly_ne = var35, #NE
  fly_intent = var97,
  fly_program_interest = var98,
  #Offset
  offset_adoption = var39, #adoption
  offset_ee = var40, #EE
  offset_pnb = var41, #PNB
  offset_ne = var42, #NE
  offset_program_interest = var100, #program interest
  offset_intent = var99,
  #PBD
  pbd_adoption = var71, #trying to
  pbd_ee = var72, #EE
  pbd_pnb = var66, #PNB
  pbd_ne = var48, #NE
  pbd_program_interest = var104, #program interest
  pbd_intent = var103, 
  #RECs
  recs_adoption = var54, #adoption
  recs_ee = var55, #EE
  recs_pnb = var56, #PNB
  recs_ne = var57, #NE
  recs_program_interest = var106, #program interest
  recs_intent = var105,
  #Solar
  solar_adoption = var59, #adoption
  solar_ee = var60, #EE
  solar_pnb = var61, #PNB
  solar_ne = var62, #NE
  solar_program_interest = var108, #program interest
  solar_intent = var107,
  #Food waste
  foodwaste_adoption = var73, #attempt
  foodwaste_ee = var74, #EE
  foodwaste_pnb = var75, #PNB
  foodwaste_ne = var76, #NE
  foodwaste_program_interest = var110, #program interest
  foodwaste_intent = var109)

library(forcats)

diff_table$ethnicity <- fct_collapse(diff_table$ethnicity, Other = c("Black", "Asian", "Other"))

diff_table <- diff_table %>% 
  mutate(
  #Adoption
  ev_adoption = case_when(ev_adoption == 0 ~ 0, TRUE ~ 1), 
  recs_adoption = case_when(recs_adoption == 1 ~ 1, TRUE ~ 0),
  # demos
  edu = var17,
  edu = as_factor(edu),
  income = var19,
  income = as_factor(income)) %>% 
      select(-var17, - var19)
  

diff_table$income <- fct_collapse(diff_table$income, "Under $30,000" = c("Less than $20,000", "$20,000 to $29,000"),
                                                      "$30,000 to $59,000" = c("$30,000 to $39,000", "$40,000 to $49,000", "$50,000 to $59,000"),
                                                      "$60,000 to $99,999" = c("$60,000 to $69,000", "$70,000 to $79,000", "$80,000 to $89,000", "$90,000 to $99,000"),
                                                      "$100,000 and over" = c("$100,000 to $149,000", "$150,000 or more"))


#rating_color <- make_color_pal(c("tomato", "#FFFFFF", "#44ab43")) "#93d3ab"

#rating_color <- make_color_pal(c("coral2", "coral1", "coral","lightgrey", "honeydew", "darkolivegreen1", "darkolivegreen2", "darkolivegreen3"))

rating_color <- make_color_pal(c("coral2", "lightgrey", "darkolivegreen1"))
```

Guide to interpreting the results in the tables. 

The tables below, broken down by each behavior, help understand: 1) if there are differences in the performance of indicators between the Boston sample and the segment of the population (for example, *Males*); and 2) how large are these differences. 

- For each behavior, the first table presents the mean indicator performance in the overall sample. For example, the value of 0.47 in row *Mean*, column *Trying to eat less meat* in the first *Eat less meat* table tells us that 47% of the population of Boston is trying to eat less meat. The second row of the same table, presents the standard deviation of that indicator in the overall sample. Standard deviation is a widely used measure of the variability or dispersion and shows how much variation there is from the mean. A small standard deviation indicates data points that cluster around the mean, whereas a large standard deviation indicates data points that are dispersed across many different values.
- For each behavior, the values in the second table represent differences, in terms of standard deviation, between indicator performance in the segment compared to the overall population. These values were calculated by taking the difference between mean indicator performance for that row segment and the mean indicator performance in the overall population, divided by the standard deviation of indicator performance in the overall sample. For example, the value of -0.12 in row *Male*, column *Trying to eat less meat* in the table *Eat less meat* tells us that the number of Males that are trying to eat less meat is 0.12 standard deviations below the average of the overall population. 
- Performing the calculations above allows us to draw comparisons between indicator performance within and across the behaviors. In these tables, psychology conventions would say that a small effect would be a difference of ~0.2, a medium effect of ~0.5, and a large effect of ~0.8. The average effect size of well-designed studies in the Social Psychology literature is ~0.3. We therefore generally concentrate our interpretation on effects that are of at least this size. If standard deviation values in the segment rows are close to 0, then the indicator performance for that segment is close to the performance in the overall population.
- For each segment, in brackets, we have provided the frequency of that segment in the sample. For example, the overall sample contains 525 *Males*. 

##### Eat less meat

- **Program interest**: Graduate degree

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
pbd_table <- diff_table %>% 
      select(age_group, sex, ethnicity, income, edu,
             contains("pbd")) %>% 
      mutate(pbd_intent = pbd_intent/100,
             pbd_ne = pbd_ne/10,
             pbd_ee = pbd_ee/10,
             pbd_program_interest = pbd_program_interest/10)

mean_pbd <- pbd_table %>% 
  summarise_if(is.numeric, list(mean), na.rm = TRUE) %>% 
  mutate(value = "Mean")

sd_pbd <- pbd_table %>% 
  summarise_if(is.numeric, list(sd), na.rm = TRUE) %>% 
  mutate(value = "Standard Deviation")

pbd_table <- pbd_table %>% 
  pivot_longer(cols = c(sex, age_group, ethnicity, income, edu), 
               names_to = "var", 
               values_to = "value") 

tally <- pbd_table %>% group_by(value) %>%
  tally()

pbd_table <- pbd_table %>%
    group_by(value) %>%
    summarise(pbd_adoption = (mean(pbd_adoption) - mean(pbd_table$pbd_adoption))/sd(pbd_table$pbd_adoption),
              pbd_intent = (mean(pbd_intent) - mean(pbd_table$pbd_intent))/sd(pbd_table$pbd_intent),
              pbd_program_interest = (mean(pbd_program_interest) - mean(pbd_table$pbd_program_interest))/sd(pbd_table$pbd_program_interest),
              pbd_ee = (mean(pbd_ee) - mean(pbd_table$pbd_ee))/sd(pbd_table$pbd_ee),
              pbd_pnb = (mean(pbd_pnb) - mean(pbd_table$pbd_pnb))/sd(pbd_table$pbd_pnb),
              pbd_ne = (mean(pbd_ne) - mean(pbd_table$pbd_ne))/sd(pbd_table$pbd_ne)) %>% 
      filter(value != "No high school")

pbd_table <- inner_join(pbd_table, tally, by = "value")

pbd_table$value <- paste0(pbd_table$value, " (", pbd_table$n, ")")

pbd_table_mean <- bind_rows(mean_pbd, sd_pbd)

pbd_table_mean <- round_df(pbd_table_mean, 2)

pbd_table_mean <- pbd_table_mean %>% 
  rename('Segment' = value,
         'Trying to eat less meat' = pbd_adoption,
         'Intention' = pbd_intent,
         'Belief that others are engaging in the behavior' = pbd_ee,
         'Belief that others should engage in the behavior' = pbd_pnb,
         'Belief that others think people should engage in the behavior' = pbd_ne,
         'Program interest' = pbd_program_interest)

pbd_table_mean <- pbd_table_mean %>% 
  select(Segment, `Trying to eat less meat`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

pbd_table_mean = reactable(pbd_table_mean,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

pbd_table_mean

pbd_table <- round_df(pbd_table, 2)

pbd_table <- pbd_table %>% 
   slice(14,12,
         4:9,
         19, 15,
         18, 2, 3, 1,
         13, 10, 17, 11, 16)

pbd_table <- pbd_table %>% 
  rename('Segment' = value,
         'Trying to eat less meat' = pbd_adoption,
         'Intention' = pbd_intent,
         'Belief that others are engaging in the behavior' = pbd_ee,
         'Belief that others should engage in the behavior' = pbd_pnb,
         'Belief that others think people should engage in the behavior' = pbd_ne,
         'Program interest' = pbd_program_interest)

pbd_table <- pbd_table %>% 
  select(Segment, `Trying to eat less meat`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

#reactable(pbd_table, defaultPageSize = 40)

#write.csv(pbd_table, "pbd_table.csv")

pbd_table <- pbd_table %>% remove_rownames %>% column_to_rownames(var = "Segment")

#BuYlRd <- function(x) rgb(colorRamp(c("coral", "#FFFFFF", "palegreen"))(x), maxColorValue = 255)

reactable(pbd_table,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
     normalized <- (value - min(pbd_table)) / (max(pbd_table) - min(pbd_table))
      color <- rating_color(normalized)
      list(background = color)
    },
    ),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))
```

##### Reduce food waste

Most of the differences between the Boston sample and segments of the population are small.

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
foodwaste_table <- diff_table %>% 
      select(age_group, sex, ethnicity, income, edu,
             contains("foodwaste")) %>% 
      mutate(foodwaste_intent = foodwaste_intent/100,
             foodwaste_ne = foodwaste_ne/10,
             foodwaste_ee = foodwaste_ee/10,
             foodwaste_program_interest = foodwaste_program_interest/10)

mean_foodwaste <- foodwaste_table %>% 
  summarise_if(is.numeric, list(mean), na.rm = TRUE) %>% 
  mutate(value = "Mean")

sd_foodwaste <- foodwaste_table %>% 
  summarise_if(is.numeric, list(sd), na.rm = TRUE) %>% 
  mutate(value = "Standard Deviation")

foodwaste_table <- foodwaste_table %>% 
  pivot_longer(cols = c(sex, age_group, ethnicity, income, edu), 
               names_to = "var", 
               values_to = "value") 

tally <- foodwaste_table %>% group_by(value) %>%
  tally()

foodwaste_table <- foodwaste_table %>%
    group_by(value) %>%
    summarise(foodwaste_adoption = (mean(foodwaste_adoption) - mean(foodwaste_table$foodwaste_adoption))/sd(foodwaste_table$foodwaste_adoption),
              foodwaste_intent = (mean(foodwaste_intent) - mean(foodwaste_table$foodwaste_intent))/sd(foodwaste_table$foodwaste_intent),
              foodwaste_program_interest = (mean(foodwaste_program_interest) - mean(foodwaste_table$foodwaste_program_interest))/sd(foodwaste_table$foodwaste_program_interest),
              foodwaste_ee = (mean(foodwaste_ee) - mean(foodwaste_table$foodwaste_ee))/sd(foodwaste_table$foodwaste_ee),
              foodwaste_pnb = (mean(foodwaste_pnb) - mean(foodwaste_table$foodwaste_pnb))/sd(foodwaste_table$foodwaste_pnb),
              foodwaste_ne = (mean(foodwaste_ne) - mean(foodwaste_table$foodwaste_ne))/sd(foodwaste_table$foodwaste_ne)) %>% 
      filter(value != "No high school")

foodwaste_table <- inner_join(foodwaste_table, tally, by = "value")

foodwaste_table$value <- paste0(foodwaste_table$value, " (", foodwaste_table$n, ")")

foodwaste_table_mean <- bind_rows(mean_foodwaste, sd_foodwaste)

foodwaste_table_mean <- round_df(foodwaste_table_mean, 2)

foodwaste_table_mean <- foodwaste_table_mean %>% 
  rename('Segment' = value,
         'Trying to reduce food waste' = foodwaste_adoption,
         'Intention' = foodwaste_intent,
         'Belief that others are engaging in the behavior' = foodwaste_ee,
         'Belief that others should engage in the behavior' = foodwaste_pnb,
         'Belief that others think people should engage in the behavior' = foodwaste_ne,
         'Program interest' = foodwaste_program_interest)

foodwaste_table_mean <- foodwaste_table_mean %>% 
  select(Segment, `Trying to reduce food waste`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

foodwaste_table_mean = reactable(foodwaste_table_mean,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

foodwaste_table_mean

foodwaste_table <- round_df(foodwaste_table, 2)

foodwaste_table <- foodwaste_table %>% 
   slice(14,12,
         4:9,
         19, 15,
         18, 2, 3, 1,
         13, 10, 17, 11, 16)

foodwaste_table <- foodwaste_table %>% 
  rename('Segment' = value,
         'Trying to reduce food waste' = foodwaste_adoption,
         'Intention' = foodwaste_intent,
         'Belief that others are engaging in the behavior' = foodwaste_ee,
         'Belief that others should engage in the behavior' = foodwaste_pnb,
         'Belief that others think people should engage in the behavior' = foodwaste_ne,
         'Program interest' = foodwaste_program_interest)

foodwaste_table <- foodwaste_table %>% 
  select(Segment, `Trying to reduce food waste`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

#reactable(foodwaste_table, defaultPageSize = 40)

#write.csv(foodwaste_table, "foodwaste_table.csv")

foodwaste_table <- foodwaste_table %>% remove_rownames %>% column_to_rownames(var = "Segment")

#BuYlRd <- function(x) rgb(colorRamp(c("coral", "#FFFFFF", "palegreen"))(x), maxColorValue = 255)

reactable(foodwaste_table,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
     normalized <- (value - min(foodwaste_table)) / (max(foodwaste_table) - min(foodwaste_table))
      color <- rating_color(normalized)
      list(background = color)
    },
    ),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))
```

##### Purchase carbon offsets

- **Intention**: 25-34; 35-44
- **Belief that others are engaging in the behavior**: 18-24
- **Program interest**: 35-44

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
offset_table <- diff_table %>% 
      select(age_group, sex, ethnicity, income, edu,
             contains("offset")) %>% 
      mutate(offset_intent = offset_intent/100,
             offset_ne = offset_ne/10,
             offset_ee = offset_ee/10,
             offset_program_interest = offset_program_interest/10)

mean_offset <- offset_table %>% 
  summarise_if(is.numeric, list(mean), na.rm = TRUE) %>% 
  mutate(value = "Mean")

sd_offset <- offset_table %>% 
  summarise_if(is.numeric, list(sd), na.rm = TRUE) %>% 
  mutate(value = "Standard Deviation")

offset_table <- offset_table %>% 
  pivot_longer(cols = c(sex, age_group, ethnicity, income, edu), 
               names_to = "var", 
               values_to = "value") 

tally <- offset_table %>% group_by(value) %>%
  tally()

offset_table <- offset_table %>%
    group_by(value) %>%
    summarise(offset_adoption = (mean(offset_adoption) - mean(offset_table$offset_adoption))/sd(offset_table$offset_adoption),
              offset_intent = (mean(offset_intent) - mean(offset_table$offset_intent))/sd(offset_table$offset_intent),
              offset_program_interest = (mean(offset_program_interest) - mean(offset_table$offset_program_interest))/sd(offset_table$offset_program_interest),
              offset_ee = (mean(offset_ee) - mean(offset_table$offset_ee))/sd(offset_table$offset_ee),
              offset_pnb = (mean(offset_pnb) - mean(offset_table$offset_pnb))/sd(offset_table$offset_pnb),
              offset_ne = (mean(offset_ne) - mean(offset_table$offset_ne))/sd(offset_table$offset_ne)) %>% 
      filter(value != "No high school")

offset_table <- inner_join(offset_table, tally, by = "value")

offset_table$value <- paste0(offset_table$value, " (", offset_table$n, ")")

offset_table_mean <- bind_rows(mean_offset, sd_offset)

offset_table_mean <- round_df(offset_table_mean, 2)

offset_table_mean <- offset_table_mean %>% 
  rename('Segment' = value,
         'Bought carbon offsets' = offset_adoption,
         'Intention' = offset_intent,
         'Belief that others are engaging in the behavior' = offset_ee,
         'Belief that others should engage in the behavior' = offset_pnb,
         'Belief that others think people should engage in the behavior' = offset_ne,
         'Program interest' = offset_program_interest)

offset_table_mean <- offset_table_mean %>% 
  select(Segment, `Bought carbon offsets`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

offset_table_mean = reactable(offset_table_mean,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

offset_table_mean

offset_table <- round_df(offset_table, 2)

offset_table <- offset_table %>% 
   slice(14,12,
         4:9,
         19, 15,
         18, 2, 3, 1,
         13, 10, 17, 11, 16)

offset_table <- offset_table %>% 
  rename('Segment' = value,
         'Bought carbon offsets' = offset_adoption,
         'Intention' = offset_intent,
         'Belief that others are engaging in the behavior' = offset_ee,
         'Belief that others should engage in the behavior' = offset_pnb,
         'Belief that others think people should engage in the behavior' = offset_ne,
         'Program interest' = offset_program_interest)

offset_table <- offset_table %>% 
  select(Segment, `Bought carbon offsets`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

#reactable(offset_table, defaultPageSize = 40)

#write.csv(offset_table, "offset_table.csv")

offset_table <- offset_table %>% remove_rownames %>% column_to_rownames(var = "Segment")

#BuYlRd <- function(x) rgb(colorRamp(c("coral", "#FFFFFF", "palegreen"))(x), maxColorValue = 255)

reactable(offset_table,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
     normalized <- (value - min(offset_table)) / (max(offset_table) - min(offset_table))
      color <- rating_color(normalized)
      list(background = color)
    },
    ),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))
```

##### Purchase green energy

Most of the differences between the Boston sample and segments of the population are small.

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
recs_table <- diff_table %>% 
      select(age_group, sex, ethnicity, income, edu,
             contains("recs")) %>% 
      mutate(recs_intent = recs_intent/100,
             recs_ne = recs_ne/10,
             recs_ee = recs_ee/10,
             recs_program_interest = recs_program_interest/10)

mean_recs <- recs_table %>% 
  summarise_if(is.numeric, list(mean), na.rm = TRUE) %>% 
  mutate(value = "Mean")

sd_recs <- recs_table %>% 
  summarise_if(is.numeric, list(sd), na.rm = TRUE) %>% 
  mutate(value = "Standard Deviation")

recs_table <- recs_table %>% 
  pivot_longer(cols = c(sex, age_group, ethnicity, income, edu), 
               names_to = "var", 
               values_to = "value") 

tally <- recs_table %>% group_by(value) %>%
  tally()

recs_table <- recs_table %>%
    group_by(value) %>%
    summarise(recs_adoption = (mean(recs_adoption) - mean(recs_table$recs_adoption))/sd(recs_table$recs_adoption),
              recs_intent = (mean(recs_intent) - mean(recs_table$recs_intent))/sd(recs_table$recs_intent),
              recs_program_interest = (mean(recs_program_interest) - mean(recs_table$recs_program_interest))/sd(recs_table$recs_program_interest),
              recs_ee = (mean(recs_ee) - mean(recs_table$recs_ee))/sd(recs_table$recs_ee),
              recs_pnb = (mean(recs_pnb) - mean(recs_table$recs_pnb))/sd(recs_table$recs_pnb),
              recs_ne = (mean(recs_ne) - mean(recs_table$recs_ne))/sd(recs_table$recs_ne)) %>% 
      filter(value != "No high school")

recs_table <- inner_join(recs_table, tally, by = "value")

recs_table$value <- paste0(recs_table$value, " (", recs_table$n, ")")

recs_table_mean <- bind_rows(mean_recs, sd_recs)

recs_table_mean <- round_df(recs_table_mean, 2)

recs_table_mean <- recs_table_mean %>% 
  rename('Segment' = value,
         'Contracted for green energy' = recs_adoption,
         'Intention' = recs_intent,
         'Belief that others are engaging in the behavior' = recs_ee,
         'Belief that others should engage in the behavior' = recs_pnb,
         'Belief that others think people should engage in the behavior' = recs_ne,
         'Program interest' = recs_program_interest)

recs_table_mean <- recs_table_mean %>% 
  select(Segment, `Contracted for green energy`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

recs_table_mean = reactable(recs_table_mean,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

recs_table_mean

recs_table <- round_df(recs_table, 2)

recs_table <- recs_table %>% 
   slice(14,12,
         4:9,
         19, 15,
         18, 2, 3, 1,
         13, 10, 17, 11, 16)

recs_table <- recs_table %>% 
  rename('Segment' = value,
         'Contracted for green energy' = recs_adoption,
         'Intention' = recs_intent,
         'Belief that others are engaging in the behavior' = recs_ee,
         'Belief that others should engage in the behavior' = recs_pnb,
         'Belief that others think people should engage in the behavior' = recs_ne,
         'Program interest' = recs_program_interest)

recs_table <- recs_table %>% 
  select(Segment, `Contracted for green energy`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

#reactable(recs_table, defaultPageSize = 40)

#write.csv(recs_table, "recs_table.csv")

recs_table <- recs_table %>% remove_rownames %>% column_to_rownames(var = "Segment")

#BuYlRd <- function(x) rgb(colorRamp(c("coral", "#FFFFFF", "palegreen"))(x), maxColorValue = 255)

reactable(recs_table,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
     normalized <- (value - min(recs_table)) / (max(recs_table) - min(recs_table))
      color <- rating_color(normalized)
      list(background = color)
    },
    ),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))
```

##### Install solar panels

- **Intention**: 35-44
- **Belief that others should engage in the behavior**: 18-24
- **Belief that others think people should engage in the behavior**: 18-24; 25-34

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
solar_table <- diff_table %>% 
      select(age_group, sex, ethnicity, income, edu,
             contains("solar")) %>% 
      mutate(solar_intent = solar_intent/100,
             solar_ne = solar_ne/10,
             solar_ee = solar_ee/10,
             solar_program_interest = solar_program_interest/10)

mean_solar <- solar_table %>% 
  summarise_if(is.numeric, list(mean), na.rm = TRUE) %>% 
  mutate(value = "Mean")

sd_solar <- solar_table %>% 
  summarise_if(is.numeric, list(sd), na.rm = TRUE) %>% 
  mutate(value = "Standard Deviation")

solar_table <- solar_table %>% 
  pivot_longer(cols = c(sex, age_group, ethnicity, income, edu), 
               names_to = "var", 
               values_to = "value") 

tally <- solar_table %>% group_by(value) %>%
  tally()

solar_table <- solar_table %>%
    group_by(value) %>%
    summarise(solar_adoption = (mean(solar_adoption) - mean(solar_table$solar_adoption))/sd(solar_table$solar_adoption),
              solar_intent = (mean(solar_intent) - mean(solar_table$solar_intent))/sd(solar_table$solar_intent),
              solar_program_interest = (mean(solar_program_interest) - mean(solar_table$solar_program_interest))/sd(solar_table$solar_program_interest),
              solar_ee = (mean(solar_ee) - mean(solar_table$solar_ee))/sd(solar_table$solar_ee),
              solar_pnb = (mean(solar_pnb) - mean(solar_table$solar_pnb))/sd(solar_table$solar_pnb),
              solar_ne = (mean(solar_ne) - mean(solar_table$solar_ne))/sd(solar_table$solar_ne)) %>% 
      filter(value != "No high school")

solar_table <- inner_join(solar_table, tally, by = "value")

solar_table$value <- paste0(solar_table$value, " (", solar_table$n, ")")

solar_table_mean <- bind_rows(mean_solar, sd_solar)

solar_table_mean <- round_df(solar_table_mean, 2)

solar_table_mean <- solar_table_mean %>% 
  rename('Segment' = value,
         'Have solar panels' = solar_adoption,
         'Intention' = solar_intent,
         'Belief that others are engaging in the behavior' = solar_ee,
         'Belief that others should engage in the behavior' = solar_pnb,
         'Belief that others think people should engage in the behavior' = solar_ne,
         'Program interest' = solar_program_interest)

solar_table_mean <- solar_table_mean %>% 
  select(Segment, `Have solar panels`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

solar_table_mean = reactable(solar_table_mean,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

solar_table_mean

solar_table <- round_df(solar_table, 2)

solar_table <- solar_table %>% 
   slice(14,12,
         4:9,
         19, 15,
         18, 2, 3, 1,
         13, 10, 17, 11, 16)

solar_table <- solar_table %>% 
  rename('Segment' = value,
         'Have solar panels' = solar_adoption,
         'Intention' = solar_intent,
         'Belief that others are engaging in the behavior' = solar_ee,
         'Belief that others should engage in the behavior' = solar_pnb,
         'Belief that others think people should engage in the behavior' = solar_ne,
         'Program interest' = solar_program_interest)

solar_table <- solar_table %>% 
  select(Segment, `Have solar panels`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

#reactable(solar_table, defaultPageSize = 40)

#write.csv(solar_table, "solar_table.csv")

solar_table <- solar_table %>% remove_rownames %>% column_to_rownames(var = "Segment")

#BuYlRd <- function(x) rgb(colorRamp(c("coral", "#FFFFFF", "palegreen"))(x), maxColorValue = 255)

reactable(solar_table,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
     normalized <- (value - min(solar_table)) / (max(solar_table) - min(solar_table))
      color <- rating_color(normalized)
      list(background = color)
    },
    ),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))
```

##### Purchase an EV

- **Adoption**: Under $30,000
- **Belief that others are engaging in the behavior**: 18-24
- **Belief that others should engage in the behavior**: 18-24
- **Program interest**: Graduate degree

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
ev_table <- diff_table %>% 
      select(age_group, sex, ethnicity, income, edu,
             contains("ev")) %>% 
      mutate(ev_intent = ev_intent/100,
             ev_ne = ev_ne/10,
             ev_ee = ev_ee/10,
             ev_program_interest = ev_program_interest/10)

mean_ev <- ev_table %>% 
  summarise_if(is.numeric, list(mean), na.rm = TRUE) %>% 
  mutate(value = "Mean")

sd_ev <- ev_table %>% 
  summarise_if(is.numeric, list(sd), na.rm = TRUE) %>% 
  mutate(value = "Standard Deviation")

ev_table <- ev_table %>% 
  pivot_longer(cols = c(sex, age_group, ethnicity, income, edu), 
               names_to = "var", 
               values_to = "value") 

tally <- ev_table %>% group_by(value) %>%
  tally()

ev_table <- ev_table %>%
    group_by(value) %>%
    summarise(ev_adoption = (mean(ev_adoption) - mean(ev_table$ev_adoption))/sd(ev_table$ev_adoption),
              ev_intent = (mean(ev_intent) - mean(ev_table$ev_intent))/sd(ev_table$ev_intent),
              ev_program_interest = (mean(ev_program_interest) - mean(ev_table$ev_program_interest))/sd(ev_table$ev_program_interest),
              ev_ee = (mean(ev_ee) - mean(ev_table$ev_ee))/sd(ev_table$ev_ee),
              ev_pnb = (mean(ev_pnb) - mean(ev_table$ev_pnb))/sd(ev_table$ev_pnb),
              ev_ne = (mean(ev_ne) - mean(ev_table$ev_ne))/sd(ev_table$ev_ne)) %>% 
      filter(value != "No high school")

ev_table <- inner_join(ev_table, tally, by = "value")

ev_table$value <- paste0(ev_table$value, " (", ev_table$n, ")")

ev_table_mean <- bind_rows(mean_ev, sd_ev)

ev_table_mean <- round_df(ev_table_mean, 2)

ev_table_mean <- ev_table_mean %>% 
  rename('Segment' = value,
         'Have an EV' = ev_adoption,
         'Intention' = ev_intent,
         'Belief that others are engaging in the behavior' = ev_ee,
         'Belief that others should engage in the behavior' = ev_pnb,
         'Belief that others think people should engage in the behavior' = ev_ne,
         'Program interest' = ev_program_interest)

ev_table_mean <- ev_table_mean %>% 
  select(Segment, `Have an EV`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

ev_table_mean = reactable(ev_table_mean,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

ev_table_mean

ev_table <- round_df(ev_table, 2)

ev_table <- ev_table %>% 
   slice(14,12,
         4:9,
         19, 15,
         18, 2, 3, 1,
         13, 10, 17, 11, 16)

ev_table <- ev_table %>% 
  rename('Segment' = value,
         'Have an EV' = ev_adoption,
         'Intention' = ev_intent,
         'Belief that others are engaging in the behavior' = ev_ee,
         'Belief that others should engage in the behavior' = ev_pnb,
         'Belief that others think people should engage in the behavior' = ev_ne,
         'Program interest' = ev_program_interest)

ev_table <- ev_table %>% 
  select(Segment, `Have an EV`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

#reactable(ev_table, defaultPageSize = 40)

#write.csv(ev_table, "ev_table.csv")

ev_table <- ev_table %>% remove_rownames %>% column_to_rownames(var = "Segment")

#BuYlRd <- function(x) rgb(colorRamp(c("coral", "#FFFFFF", "palegreen"))(x), maxColorValue = 255)

reactable(ev_table,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
     normalized <- (value - min(ev_table)) / (max(ev_table) - min(ev_table))
      color <- rating_color(normalized)
      list(background = color)
    },
    ),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))
```

##### Fly less

- **Program interest**: Graduate degree

```{r, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE}
fly_table <- diff_table %>% 
      select(age_group, sex, ethnicity, income, edu,
             contains("fly")) %>% 
      mutate(fly_intent = fly_intent/100,
             fly_ne = fly_ne/10,
             fly_ee = fly_ee/10,
             fly_program_interest = fly_program_interest/10)

mean_fly <- fly_table %>% 
  summarise_if(is.numeric, list(mean), na.rm = TRUE) %>% 
  mutate(value = "Mean")

sd_fly <- fly_table %>% 
  summarise_if(is.numeric, list(sd), na.rm = TRUE) %>% 
  mutate(value = "Standard Dflyiation")

fly_table <- fly_table %>% 
  pivot_longer(cols = c(sex, age_group, ethnicity, income, edu), 
               names_to = "var", 
               values_to = "value") 

tally <- fly_table %>% group_by(value) %>%
  tally()

fly_table <- fly_table %>%
    group_by(value) %>%
    summarise(fly_adoption = (mean(fly_adoption) - mean(fly_table$fly_adoption))/sd(fly_table$fly_adoption),
              fly_intent = (mean(fly_intent) - mean(fly_table$fly_intent))/sd(fly_table$fly_intent),
              fly_program_interest = (mean(fly_program_interest) - mean(fly_table$fly_program_interest))/sd(fly_table$fly_program_interest),
              fly_ee = (mean(fly_ee) - mean(fly_table$fly_ee))/sd(fly_table$fly_ee),
              fly_pnb = (mean(fly_pnb) - mean(fly_table$fly_pnb))/sd(fly_table$fly_pnb),
              fly_ne = (mean(fly_ne) - mean(fly_table$fly_ne))/sd(fly_table$fly_ne)) %>% 
      filter(value != "No high school")

fly_table <- inner_join(fly_table, tally, by = "value")

fly_table$value <- paste0(fly_table$value, " (", fly_table$n, ")")

fly_table_mean <- bind_rows(mean_fly, sd_fly)

fly_table_mean <- round_df(fly_table_mean, 2)

fly_table_mean <- fly_table_mean %>% 
  rename('Segment' = value,
         'Trying to fly less' = fly_adoption,
         'Intention' = fly_intent,
         'Belief that others are engaging in the behavior' = fly_ee,
         'Belief that others should engage in the behavior' = fly_pnb,
         'Belief that others think people should engage in the behavior' = fly_ne,
         'Program interest' = fly_program_interest)

fly_table_mean <- fly_table_mean %>% 
  select(Segment, `Trying to fly less`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

fly_table_mean = reactable(fly_table_mean,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))

fly_table_mean

fly_table <- round_df(fly_table, 2)

fly_table <- fly_table %>% 
   slice(14,12,
         4:9,
         19, 15,
         18, 2, 3, 1,
         13, 10, 17, 11, 16)

fly_table <- fly_table %>% 
  rename('Segment' = value,
         'Trying to fly less' = fly_adoption,
         'Intention' = fly_intent,
         'Belief that others are engaging in the behavior' = fly_ee,
         'Belief that others should engage in the behavior' = fly_pnb,
         'Belief that others think people should engage in the behavior' = fly_ne,
         'Program interest' = fly_program_interest)

fly_table <- fly_table %>% 
  select(Segment, `Trying to fly less`, `Intention`, `Belief that others are engaging in the behavior`, `Belief that others should engage in the behavior`, `Belief that others think people should engage in the behavior`,  `Program interest`)

#reactable(fly_table, defaultPageSize = 40)

#write.csv(fly_table, "fly_table.csv")

fly_table <- fly_table %>% remove_rownames %>% column_to_rownames(var = "Segment")

#BuYlRd <- function(x) rgb(colorRamp(c("coral", "#FFFFFF", "palegreen"))(x), maxColorValue = 255)

reactable(fly_table,
          defaultPageSize = 40,
  style = list(fontSize = "11px"),
defaultColDef = colDef(
    style = function(value) {
      if (!is.numeric(value)) return()
     normalized <- (value - min(fly_table)) / (max(fly_table) - min(fly_table))
      color <- rating_color(normalized)
      list(background = color)
    },
    ),
  showSortIcon = FALSE,
    pagination = TRUE,
    compact = TRUE,
    borderless = FALSE,
    striped = TRUE,
    highlight = TRUE,  
    fullWidth = TRUE,
  theme = reactableTheme(
      headerStyle = list(
        "&:hover[aria-sort]" = list(background = "hsl(0, 0%, 96%)"),
        "&[aria-sort='ascending'], &[aria-sort='descending']" = list(background = "hsl(0, 0%, 96%)"),
        borderColor = "#555"
      )))
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, eval = FALSE}
library(jtools)
options("jtools-digits" = 6)
reg <- data %>% 
  select(
  wt,
  #Vrid,
  #var13, #RID
  #EV
  var26, #adoption
  #Fly
  var70, #Are you trying to fly less frequently than you used to?
  #Offsets
  var39, #adoption
  #PBD
  var71, #Are you trying to eat less meat than you used to?
  #RECs
  var54, #adoption
  #Solar
  var59, #adoption
  #Food waste
  var73, #Are you currently trying to reduce the amount of food waste you produce?
  #demographics
  #age_group,
  #sex,
  ethnicity,
  #var20, #politics
  var19, #income
  var17, #education
  ) %>% 
  rename(
  #EV
  ev_adoption = var26,
  #Fly
  fly_adoption = var70, #trying to fly less
  #Offset
  offset_adoption = var39, #adoption
  #PBD
  pbd_adoption = var71, #trying to
  #RECs
  recs_adoption = var54, #adoption
  #Solar
  solar_adoption = var59, #adoption
  #Food waste
  foodwaste_adoption = var73, #attempt
  #dem
  income = var19, 
  education = var17) 

reg <- within(reg, ethnicity <- relevel(ethnicity, ref = "White"))
#reg <- within(reg, age_group <- relevel(age_group, ref = "65+"))

reg <- reg %>% 
  mutate(
    ev_adoption = case_when(ev_adoption == 0 ~ 0, 
                            ev_adoption == 1 ~ 1,
                             ev_adoption == 2 ~ 1,
                             ev_adoption == 3 ~ 1,
                             ev_adoption == 4 ~ 1,
                            ev_adoption == 5 ~ 1,
                            ev_adoption == 6 ~ 1,
                            ev_adoption == 10097 ~ 1,
                             ev_adoption == NA ~ 0),
    recs_adoption = case_when(recs_adoption == 1 ~ 1, TRUE ~ 0),
    income = as.numeric(income),
    income = case_when(income == 10063 ~ 11, TRUE ~ income)) %>% 
  filter(ethnicity != "Other")

reg$education_category = recode(reg$education, '1' = "No college degree", '2' = "No college degree", '3' = "No college degree", '4' = "No college degree", '5' = "College degree", '6' = "Graduate degree")

reg$education_category <- as.factor(reg$education_category)

reg <- within(reg, education_category <- relevel(education_category, ref = "No college degree"))

reg$income_category = recode(reg$income, '1' = "Less than $30,000", '2' = "Less than $30,000", '3' = "$30,000 to $49,000", '4' = "$30,000 to $49,000", '5' = "$50,000 to $69,000", '6' = "$50,000 to $69,000", '7' = "$70,000 to $89,000", '8' = "$70,000 to $89,000", '9' = "$90,000 to $149,000", '10' = "$90,000 to $149,000", '11' = "$150,000 or more")

reg$income_category <- as.factor(reg$income_category)

reg <- within(reg, income_category <- relevel(income_category, ref = "Less than $30,000"))
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, eval = FALSE}

ev_d_w <- reg %>% 
  lm(scale(ev_adoption) ~ income_category + education_category + ethnicity, weights = wt, data =.)

ev_d_w <- tidy(ev_d_w) %>% mutate(model = "ev_d_w")


#summary(ev_d_w) 


solar_d_w <- reg %>%
    lm(scale(solar_adoption) ~ income_category + education_category + ethnicity, weights = wt, data =.)
  
solar_d_w <- tidy(solar_d_w) %>% mutate(model = "solar_d_w")


offset_d_w <- reg %>% 
  lm(scale(offset_adoption) ~ income_category + education_category + ethnicity, weights = wt, data =.)

offset_d_w <- tidy(offset_d_w) %>% mutate(model = "offset_d_w")




recs_d_w <- reg %>% 
  lm(scale(recs_adoption) ~ income_category + education_category + ethnicity, weights = wt, data =.)



recs_d_w <- tidy(recs_d_w) %>% mutate(model = "recs_d_w")


fly_less_d_w <- reg %>% 
  lm(scale(fly_adoption) ~ income_category + education_category + ethnicity, weights = wt, data =.)

fly_less_d_w <- tidy(fly_less_d_w) %>% mutate(model = "fly_less_d_w")




#summary(fly_less_w)

pbd_d_w <- reg %>% 
  lm(scale(pbd_adoption) ~  income_category + education_category + ethnicity, weights = wt, data =.)

pbd_d_w <- tidy(pbd_d_w) %>% mutate(model = "pbd_d_w")





#summary(pbd_d_w)



food_waste_d_w <- reg %>% 
  lm(scale(foodwaste_adoption) ~ income_category + education_category + ethnicity, weights = wt, data =.)

food_waste_d_w <- tidy(food_waste_d_w) %>% mutate(model = "food_waste_d_w")



#summary(food_waste_w)
```

```{r, include = FALSE, echo = FALSE, results = 'asis', message = FALSE, warning = FALSE, eval = FALSE}
# Use tibble dfs
models <- rbind(ev_d_w, offset_d_w, recs_d_w, solar_d_w, food_waste_d_w, pbd_d_w, fly_less_d_w)

p <- {dwplot(models, 
        vline = geom_vline(xintercept = 0, colour = "grey60", linetype = 2), 
        # Customize the of appearance of the dots and whiskers
        dot_args = list(aes(shape = model)),
        whisker_args = list(aes(linetype = model))) %>%
    # Put models on one graph by assigning them to the same names
    relabel_predictors(c("ethnicityAsian" = "Ethnicity: Asian",
                         "ethnicityBlack" = "Ethnicity: Black or \nAfrican American",
                         #"ethnicityOther" = "Ethnicity: Other",
                         "income_category$30,000 to $49,000" = "Household income: \n$30,000 to $49,000",
                         "income_category$50,000 to $69,000" = "Household income: \n$50,000 to $69,000",
                         "income_category$70,000 to $89,000" = "Household income: \n$70,000 to $89,000",
                         "income_category$90,000 to $149,000" = "Household income: \n$90,000 to $149,000",
                         "income_category$150,000 or more" = "Household income: \n$150,000 or more",
                         "education_categoryCollege degree" = "Education level: \nBachelor's degree",
                         "education_categoryGraduate degree" = "Education level: \nGraduate degree")) +
    xlab("Standardized coefficient estimate") + ylab("") + 
    theme_bw() +
    # Add colorblind-friendly palette & legend values = c("#000000","#D55E00","#CC79A7","#0072B2")
    scale_colour_manual(values = c("#000000","#000000","#000000","#000000", "red", "red", "red"), 
                     name = "", 
                     labels = c("Own an EV", "Bought offsets", "Contracted for green energy", "Installed solar", "Trying to reduce food waste", "Trying to eat less meat", "Trying to fly less"),
                     guide = guide_legend(reverse = TRUE)) +
    # Add customized glyphs
    scale_shape_manual(values = c(16, 4, 15, 3, 8, 6, 0),
                      name = "",
                      labels = c("Own an EV", "Bought offsets", "Contracted for green energy", "Installed solar", "Trying to reduce food waste", "Trying to eat less meat", "Trying to fly less"),
                      guide = guide_legend(reverse = TRUE)) +
   theme(#axis.title = element_text(size = 16),
         #plot.margin = unit(c(0,0,0,0),"cm"),
         #text = element_text(family="TT Times New Roman"),
         legend.justification = c(0, 0), 
         # Legend bottom right position 
         legend.position = c(0.005, 0.000001),
         # Legend text size
         legend.text = element_text(size = 8, colour = "black"),
         #legend.title.align = .5,
         # Transparent legend text and glyph background
         legend.background = element_rect(fill= "transparent"),
         legend.key = element_rect(colour = "transparent", fill = "transparent"),
         # Axis
         axis.line = element_line(color = "grey"),
         axis.ticks = element_line(color = "grey"),
         axis.text.x  = element_text(hjust = 1, size = 11, color = "black"),
         axis.text.y = element_text(size = 11, color = "black"),
         axis.title.x = element_text(color = "black", size = 11),
         axis.title.y = element_text(color = "black", size = 11),
         # Panel
         #panel.grid.major = element_line(size = 0.25, linetype = 'solid', color = "grey"), 
         #panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey"),
         panel.background = element_blank(),
         panel.border = element_rect(color = "grey", fill = NA, size = 0.5))}
grid.draw(p)
ggsave("adoption-demo.png", units = "in", width = 11, height = 13, device='png', dpi = 300)
```